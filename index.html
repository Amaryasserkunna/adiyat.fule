<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸš€ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±</title>
<style>
  /* ========== Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ÙØ§ØªØ­ ========== */
  :root {
    /* Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† ÙØ§ØªØ­ Ø¹ØµØ±ÙŠ */
    --primary: #3b82f6;
    --primary-light: #60a5fa;
    --primary-dark: #2563eb;
    --secondary: #8b5cf6;
    --accent: #06b6d4;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --info: #3b82f6;
    
    /* Ù†Ø¸Ø§Ù… Ø£Ù„ÙˆØ§Ù† ÙØ§ØªØ­Ø© */
    --light: #ffffff;
    --lighter: #f8fafc;
    --light-gray: #f1f5f9;
    --light-gray-2: #e2e8f0;
    --light-gray-3: #cbd5e1;
    
    /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ */
    --text-dark: #1e293b;
    --text-gray: #64748b;
    --text-light: #94a3b8;
    
    /* Ø®Ù„ÙÙŠØ§Øª */
    --bg-body: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    --bg-card: #ffffff;
    --bg-card-hover: #f8fafc;
    --bg-input: #f8fafc;
    --bg-modal: #ffffff;
    
    /* Ø¸Ù„Ø§Ù„ */
    --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.12);
    --shadow-sm: 0 2px 10px rgba(0, 0, 0, 0.04);
    --shadow-neon: 0 0 20px rgba(59, 130, 246, 0.2);
    
    /* Ø£Ø¨Ø¹Ø§Ø¯ */
    --radius: 12px;
    --radius-sm: 6px;
    --radius-lg: 20px;
    --radius-xl: 30px;
    
    /* Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø®Ø·ÙˆØ· */
    --text-xs: 0.75rem;
    --text-sm: 0.875rem;
    --text-base: 1rem;
    --text-lg: 1.125rem;
    --text-xl: 1.25rem;
    --text-2xl: 1.5rem;
    --text-3xl: 1.875rem;
    --text-4xl: 2.25rem;
    
    /* ØªØ­ÙˆÙ„Ø§Øª */
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* ========== Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ========== */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-size: 16px;
    scroll-behavior: smooth;
  }

  body {
    font-family: 'Cairo', 'Tajawal', system-ui, -apple-system, sans-serif;
    background: var(--bg-body);
    color: var(--text-dark);
    line-height: 1.6;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
  }

  /* Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø© Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª */
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
      radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.08) 0%, transparent 50%),
      radial-gradient(circle at 40% 80%, rgba(6, 182, 212, 0.08) 0%, transparent 50%);
    z-index: -1;
    pointer-events: none;
  }

  /* ========== ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø­ÙˆØ§Ù ========== */
  .border-gradient {
    position: relative;
    border: 2px solid transparent;
    background: linear-gradient(var(--bg-card), var(--bg-card)) padding-box,
                linear-gradient(135deg, var(--primary), var(--accent)) border-box;
  }

  .shadow-glow {
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.15);
  }

  .shadow-glow:hover {
    box-shadow: 0 0 25px rgba(59, 130, 246, 0.25);
  }

  /* ========== Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ========== */
  .login-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-body);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    transition: var(--transition);
    padding: 1rem;
  }

  .login-container.hidden {
    opacity: 0;
    visibility: hidden;
    transform: translateY(-30px);
  }

  .login-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    width: 100%;
    max-width: 1000px;
    height: 600px;
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--light-gray-2);
  }

  .login-side {
    background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
    padding: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    position: relative;
    overflow: hidden;
  }

  .login-side::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none" opacity="0.1"><path d="M0,0 L100,0 L100,100 Z" fill="white"/></svg>');
    background-size: cover;
  }

  .login-content {
    padding: 3rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .login-logo {
    max-width: 180px;
    height: auto;
    margin-bottom: 2rem;
    filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.1));
  }

  .login-title {
    font-size: var(--text-3xl);
    font-weight: 800;
    margin-bottom: 0.5rem;
    background: linear-gradient(135deg, #fff 0%, #e0e7ff 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .login-subtitle {
    color: rgba(255, 255, 255, 0.9);
    font-size: var(--text-base);
    margin-bottom: 3rem;
  }

  .login-features {
    margin-top: 2rem;
  }

  .feature {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
    color: rgba(255, 255, 255, 0.95);
  }

  .feature i {
    color: var(--accent);
    font-size: 1.25rem;
  }

  .login-form {
    width: 100%;
  }

  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
    font-weight: 600;
    font-size: var(--text-sm);
  }

  .input-group {
    position: relative;
  }

  .input-group input {
    width: 100%;
    padding: 0.75rem 3rem 0.75rem 1rem;
  }

  .input-icon {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary);
    font-size: 1rem;
    pointer-events: none;
  }

  .form-input {
    width: 100%;
    padding: 1rem 3rem 1rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--light-gray-2);
    border-radius: var(--radius);
    color: var(--text-dark);
    font-size: var(--text-base);
    transition: var(--transition);
    outline: none;
  }

  .form-input:focus {
    border-color: var(--primary);
    box-shadow: var(--shadow-neon);
    background: var(--bg-card);
  }

  .password-toggle {
    position: absolute;
    left: 1rem;
    top: 55%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: var(--text-gray);
    cursor: pointer;
    font-size: 1rem;
  }

  .login-btn {
    width: 100%;
    padding: 1rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    border: none;
    border-radius: var(--radius);
    font-size: var(--text-base);
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1rem;
  }

  .login-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-neon);
  }

  .login-error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: var(--radius);
    padding: 1rem;
    margin-top: 1rem;
    display: none;
    align-items: center;
    gap: 0.75rem;
    color: #dc2626;
    font-size: var(--text-sm);
  }

  /* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ ========== */
  .app-container {
    display: flex;
    min-height: 100vh;
    opacity: 0;
    animation: fadeIn 0.5s ease-out forwards;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  .hidden {
    display: none !important;
  }

  /* ========== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ ========== */
  .sidebar {
    width: 280px;
    background: var(--bg-card);
    border-left: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    z-index: 100;
    transition: var(--transition);
  }

  .sidebar-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--light-gray-2);
    text-align: center;
  }

  .sidebar-logo {
    max-width: 160px;
    height: auto;
    margin-bottom: 1rem;
  }

  .sidebar-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 0.25rem;
  }

  .sidebar-subtitle {
    font-size: var(--text-sm);
    color: var(--text-gray);
  }

  .nav-menu {
    flex: 1;
    padding: 1.5rem 0;
    overflow-y: auto;
  }

  .nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.5rem;
    color: var(--text-dark);
    text-decoration: none;
    transition: var(--transition);
    border-right: 3px solid transparent;
    margin: 0.25rem 0;
    cursor: pointer;
  }

  .nav-item:hover {
    background: var(--light-gray);
    border-right-color: var(--primary-light);
    color: var(--primary);
  }

  .nav-item.active {
    background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
    border-right-color: var(--primary);
    color: var(--primary);
    font-weight: 600;
  }

  .nav-item i {
    width: 20px;
    text-align: center;
    font-size: 1.1rem;
  }

  .nav-item-text {
    flex: 1;
  }

  .nav-badge {
    background: var(--primary);
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: 600;
    min-width: 24px;
    text-align: center;
  }

  .sidebar-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--light-gray-2);
    background: var(--light-gray);
  }

  .user-info-sidebar {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .user-avatar-sidebar {
    width: 3rem;
    height: 3rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.25rem;
    color: white;
    box-shadow: var(--shadow);
  }

  .user-details-sidebar {
    flex: 1;
  }

  .user-name-sidebar {
    font-weight: 700;
    color: var(--text-dark);
    font-size: var(--text-sm);
  }

  .user-role-sidebar {
    font-size: var(--text-xs);
    color: var(--primary);
    background: rgba(59, 130, 246, 0.1);
    padding: 0.25rem 0.5rem;
    border-radius: 50px;
    font-weight: 600;
    display: inline-block;
  }

  .logout-btn-sidebar {
    width: 100%;
    padding: 0.75rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: var(--radius);
    color: var(--danger);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  .logout-btn-sidebar:hover {
    background: rgba(239, 68, 68, 0.15);
    border-color: var(--danger);
    transform: translateY(-2px);
  }

  /* ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== */
  .main-content {
    flex: 1;
    margin-right: 280px;
    padding: 1.5rem;
    transition: var(--transition);
  }

  .page-header {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .page-title {
    font-size: var(--text-2xl);
    font-weight: 800;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .page-title i {
    color: var(--primary);
  }

  .page-subtitle {
    color: var(--text-gray);
    font-size: var(--text-sm);
    margin-top: 0.25rem;
  }

  .page-actions {
    display: flex;
    gap: 0.5rem;
  }

  /* ========== Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø§Øª ========== */
  .page-content {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 2rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow);
    margin-bottom: 1.5rem;
  }

  /* ========== Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ========== */
  .dashboard-page {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .stat-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    text-align: center;
    transition: var(--transition);
    border: 1px solid var(--light-gray-2);
    position: relative;
    overflow: hidden;
  }

  .stat-card:hover {
    transform: translateY(-5px);
    border-color: var(--primary);
    box-shadow: var(--shadow-lg);
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
  }

  .stat-icon {
    width: 4rem;
    height: 4rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    color: white;
    font-size: 1.5rem;
  }

  .stat-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    color: var(--text-gray);
    font-size: var(--text-sm);
  }

  .stat-change {
    font-size: var(--text-xs);
    margin-top: 0.5rem;
  }

  .stat-change.positive {
    color: var(--success);
  }

  .stat-change.negative {
    color: var(--danger);
  }

  /* ========== Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
  .form-section {
    margin-bottom: 2rem;
  }

  .section-title {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--light-gray-2);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .section-title i {
    color: var(--primary);
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .form-group {
    position: relative;
  }

  .form-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
    color: var(--text-dark);
    font-weight: 600;
    font-size: var(--text-sm);
  }

  .form-label i {
    color: var(--primary);
  }

  .form-input,
  .form-select,
  .form-textarea {
    width: 100%;
    padding: 0.875rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--light-gray-2);
    border-radius: var(--radius);
    color: var(--text-dark);
    font-size: var(--text-base);
    transition: var(--transition);
    outline: none;
  }

  .form-textarea {
    min-height: 100px;
    resize: vertical;
  }

  .form-input:focus,
  .form-select:focus,
  .form-textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .form-input[readonly] {
    background: var(--light-gray);
    border-color: var(--light-gray-2);
    color: var(--text-gray);
  }

  /* ========== Ø§Ù„Ø£Ø²Ø±Ø§Ø± ========== */
  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: var(--radius);
    font-size: var(--text-sm);
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0));
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .btn:hover::before {
    opacity: 1;
  }

  .btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  .btn:active {
    transform: translateY(0);
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
  }

  .btn-success {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
  }

  .btn-warning {
    background: linear-gradient(135deg, var(--warning), #d97706);
    color: white;
  }

  .btn-danger {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
  }

  .btn-accent {
    background: linear-gradient(135deg, var(--accent), #0891b2);
    color: white;
  }

  .btn-info {
    background: linear-gradient(135deg, var(--info), #2563eb);
    color: white;
  }

  .btn-ghost {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
  }

  .btn-ghost:hover {
    background: rgba(59, 130, 246, 0.1);
  }

  .btn-sm {
    padding: 0.5rem 1rem;
    font-size: var(--text-xs);
  }

  .btn-lg {
    padding: 1rem 2rem;
    font-size: var(--text-base);
  }

  /* ========== Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ========== */
  .table-container {
    background: var(--bg-card);
    border-radius: var(--radius);
    overflow: hidden;
    border: 1px solid var(--light-gray-2);
    margin-top: 2rem;
  }

  .table-header {
    padding: 1.5rem;
    background: var(--light-gray);
    border-bottom: 1px solid var(--light-gray-2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .table-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .table-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .table-responsive {
    overflow-x: auto;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
  }

  .data-table thead {
    background: linear-gradient(90deg, var(--primary-dark), var(--primary));
  }

  .data-table th {
    padding: 1.25rem;
    text-align: right;
    font-weight: 600;
    color: white;
    white-space: nowrap;
    font-size: var(--text-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .data-table tbody tr {
    border-bottom: 1px solid var(--light-gray-2);
    transition: var(--transition);
  }

  .data-table tbody tr:hover {
    background: var(--light-gray);
    transform: translateX(2px);
  }

  .data-table td {
    padding: 1.25rem;
    color: var(--text-dark);
    vertical-align: middle;
  }

  /* ========== ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ========== */
  .vehicle-type {
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: var(--text-xs);
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .type-petrol {
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: white;
  }

  .type-diesel {
    background: linear-gradient(135deg, var(--accent), #0891b2);
    color: white;
  }

  .type-generator {
    background: linear-gradient(135deg, var(--warning), #d97706);
    color: white;
  }

  /* ========== Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª ========== */
  .badge {
    padding: 0.375rem 0.75rem;
    border-radius: 50px;
    font-size: var(--text-xs);
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
  }

  .badge-success {
    background: linear-gradient(135deg, var(--success), #059669);
    color: white;
  }

  .badge-warning {
    background: linear-gradient(135deg, var(--warning), #d97706);
    color: white;
  }

  .badge-danger {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
  }

  .badge-primary {
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    color: white;
  }

  .badge-info {
    background: linear-gradient(135deg, var(--info), #2563eb);
    color: white;
  }

  /* ========== Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ========== */
  #alertsContainer {
    position: fixed;
    bottom: 2rem;
    left: 2rem;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    max-width: 400px;
  }

  .alert {
    padding: 1rem 1.25rem;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: slideInLeft 0.3s ease-out;
    box-shadow: var(--shadow);
    font-size: var(--text-sm);
    border-right: 4px solid;
    backdrop-filter: blur(10px);
    background: var(--bg-card);
  }

  @keyframes slideInLeft {
    from {
      opacity: 0;
      transform: translateX(-100%);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .alert-success {
    border-color: var(--success);
    color: #059669;
    background: rgba(16, 185, 129, 0.1);
  }

  .alert-error {
    border-color: var(--danger);
    color: #dc2626;
    background: rgba(239, 68, 68, 0.1);
  }

  .alert-warning {
    border-color: var(--warning);
    color: #d97706;
    background: rgba(245, 158, 11, 0.1);
  }

  .alert-info {
    border-color: var(--info);
    color: #2563eb;
    background: rgba(59, 130, 246, 0.1);
  }

  /* ========== Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ========== */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    padding: 1rem;
    animation: fadeIn 0.3s ease-out;
  }

  .modal-content {
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    width: 100%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-lg);
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid var(--light-gray-2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-title {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
  }

  .modal-close {
    background: var(--light-gray);
    border: none;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-gray);
    cursor: pointer;
    transition: var(--transition);
  }

  .modal-close:hover {
    background: var(--light-gray-2);
    color: var(--danger);
  }

  .modal-body {
    padding: 1.5rem;
  }

  /* ========== Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªØ­Ù…ÙŠÙ„ ========== */
  .loader {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }

  .spinner {
    width: 2.5rem;
    height: 2.5rem;
    border: 3px solid rgba(59, 130, 246, 0.1);
    border-radius: 50%;
    border-top-color: var(--primary);
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* ========== ÙØ§ØµÙ„ ========== */
  .divider {
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--light-gray-2), transparent);
    margin: 2rem 0;
  }

  /* ========== Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‚Ø± ========== */
  .clickable {
    cursor: pointer;
    transition: var(--transition);
  }

  .clickable:hover {
    opacity: 0.8;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ========== */
  @media print {
    .no-print {
      display: none !important;
    }
    
    body {
      background: white !important;
      color: black !important;
    }
    
    .page-content {
      box-shadow: none !important;
      border: 1px solid #ddd !important;
    }
  }

  /* ========== Ø§Ù„ØªØ¬Ø§ÙˆØ¨ ========== */
  @media (max-width: 1200px) {
    .sidebar {
      width: 250px;
    }
    
    .main-content {
      margin-right: 250px;
    }
  }

  @media (max-width: 992px) {
    .sidebar {
      transform: translateX(100%);
      position: fixed;
      top: 0;
      right: 0;
      width: 300px;
    }
    
    .sidebar.active {
      transform: translateX(0);
    }
    
    .main-content {
      margin-right: 0;
    }
    
    .mobile-menu-toggle {
      display: flex;
    }
  }

  @media (max-width: 768px) {
    .dashboard-page {
      grid-template-columns: 1fr;
    }
    
    .page-header {
      flex-direction: column;
      gap: 1rem;
      align-items: flex-start;
    }
    
    .page-actions {
      width: 100%;
      justify-content: flex-start;
    }
    
    .form-grid {
      grid-template-columns: 1fr;
    }
    
    .table-header {
      flex-direction: column;
      align-items: stretch;
      gap: 1rem;
    }
    
    .data-table th,
    .data-table td {
      padding: 1rem;
      font-size: var(--text-xs);
    }
  }

  @media (max-width: 480px) {
    .page-content {
      padding: 1.5rem;
    }
    
    .btn-group {
      flex-direction: column;
      width: 100%;
    }
    
    .btn {
      width: 100%;
    }
  }

  /* ========== Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø¬ÙˆØ§Ù„ ========== */
  .mobile-menu-toggle {
    display: none;
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 101;
    width: 3rem;
    height: 3rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border: none;
    border-radius: var(--radius);
    color: white;
    font-size: 1.25rem;
    cursor: pointer;
    box-shadow: var(--shadow);
    align-items: center;
    justify-content: center;
  }

  @media (max-width: 992px) {
    .mobile-menu-toggle {
      display: flex;
    }
  }

  /* ========== Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± ========== */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    background: var(--light-gray);
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, var(--primary-light), var(--accent));
  }

  /* ========== Ø­Ø§Ù„Ø§Øª Ø®Ø§ØµØ© ========== */
  .empty-state {
    text-align: center;
    padding: 3rem 1rem;
    color: var(--text-gray);
  }

  .empty-state-icon {
    font-size: 3rem;
    color: var(--light-gray-3);
    margin-bottom: 1rem;
  }

  .empty-state-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
  }

  .empty-state-description {
    font-size: var(--text-base);
    max-width: 400px;
    margin: 0 auto;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© ========== */
  .progress-bar {
    height: 8px;
    background: var(--light-gray-2);
    border-radius: 4px;
    overflow: hidden;
    margin: 0.5rem 0;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  .chart-container {
    position: relative;
    height: 300px;
    margin: 1rem 0;
    padding: 1rem;
    background: var(--light-gray);
    border-radius: var(--radius);
  }

  .tab-container {
    margin: 1rem 0;
  }

  .tab-header {
    display: flex;
    border-bottom: 2px solid var(--light-gray-2);
    margin-bottom: 1rem;
  }

  .tab-button {
    padding: 0.75rem 1.5rem;
    background: transparent;
    border: none;
    color: var(--text-gray);
    font-weight: 600;
    cursor: pointer;
    position: relative;
    transition: var(--transition);
  }

  .tab-button.active {
    color: var(--primary);
  }

  .tab-button.active::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--primary);
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  .card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-sm);
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--light-gray-2);
  }

  .card-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
  }

  .card-body {
    color: var(--text-gray);
  }

  .timeline {
    position: relative;
    padding-right: 2rem;
  }

  .timeline::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 2px;
    background: var(--light-gray-2);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .timeline-item::before {
    content: '';
    position: absolute;
    top: 0.5rem;
    right: -2.5rem;
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 50%;
    background: var(--primary);
  }

  .timeline-content {
    background: var(--light-gray);
    padding: 1rem;
    border-radius: var(--radius);
  }

  .timeline-date {
    font-size: var(--text-xs);
    color: var(--text-gray);
    margin-bottom: 0.25rem;
  }

  .timeline-title {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
  }

  .timeline-description {
    font-size: var(--text-sm);
    color: var(--text-gray);
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ========== */
  .vehicle-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-sm);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .vehicle-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
    border-color: var(--primary);
  }

  .vehicle-card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .vehicle-card-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
  }

  .vehicle-card-body {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .vehicle-info-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: var(--text-sm);
  }

  .vehicle-info-item i {
    color: var(--primary);
    width: 1rem;
    text-align: center;
  }

  .vehicle-info-label {
    color: var(--text-gray);
    font-weight: 500;
  }

  .vehicle-info-value {
    color: var(--text-dark);
    font-weight: 600;
  }

  .fuel-record-card {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-sm);
    margin-bottom: 1rem;
    transition: var(--transition);
  }

  .fuel-record-card:hover {
    box-shadow: var(--shadow);
  }

  .fuel-record-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--light-gray-2);
  }

  .fuel-record-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
  }

  .fuel-record-id {
    font-size: var(--text-sm);
    color: var(--primary);
    font-weight: 600;
  }

  .fuel-record-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .fuel-record-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .fuel-record-label {
    font-size: var(--text-xs);
    color: var(--text-gray);
    font-weight: 500;
  }

  .fuel-record-value {
    font-size: var(--text-base);
    color: var(--text-dark);
    font-weight: 600;
  }

  .fuel-record-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid var(--light-gray-2);
  }

  .status-indicator {
    width: 0.5rem;
    height: 0.5rem;
    border-radius: 50%;
    display: inline-block;
    margin-left: 0.5rem;
  }

  .status-active {
    background: var(--success);
    animation: pulse 2s infinite;
  }

  .status-inactive {
    background: var(--danger);
  }

  .status-warning {
    background: var(--warning);
  }

  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
    }
    70% {
      box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
    }
  }

  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .filter-chip {
    padding: 0.5rem 1rem;
    background: var(--light-gray);
    border: 1px solid var(--light-gray-2);
    border-radius: 20px;
    font-size: var(--text-sm);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-chip:hover {
    background: var(--light-gray-2);
  }

  .filter-chip.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .filter-chip i {
    font-size: 0.875rem;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card-mini {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-sm);
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .stat-icon-mini {
    width: 3rem;
    height: 3rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.25rem;
  }

  .stat-content {
    flex: 1;
  }

  .stat-value-mini {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
  }

  .stat-label-mini {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  .search-box {
    position: relative;
    margin-bottom: 1.5rem;
  }

  .search-input {
    width: 100%;
    padding: 1rem 3rem 1rem 1rem;
    background: var(--bg-input);
    border: 2px solid var(--light-gray-2);
    border-radius: var(--radius);
    font-size: var(--text-base);
    transition: var(--transition);
  }

  .search-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary);
    font-size: 1.25rem;
  }

  .data-summary {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 1.5rem;
    border-radius: var(--radius);
    margin-bottom: 2rem;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .summary-item {
    text-align: center;
  }

  .summary-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    margin-bottom: 0.25rem;
  }

  .summary-label {
    font-size: var(--text-sm);
    opacity: 0.9;
  }

  .export-options {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .export-btn {
    padding: 0.5rem 1rem;
    background: var(--light-gray);
    border: 1px solid var(--light-gray-2);
    border-radius: var(--radius);
    font-size: var(--text-xs);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .export-btn:hover {
    background: var(--light-gray-2);
  }

  .export-btn i {
    font-size: 0.875rem;
  }

  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
  }

  .pagination-btn {
    padding: 0.5rem 0.75rem;
    background: var(--bg-card);
    border: 1px solid var(--light-gray-2);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition);
    font-size: var(--text-sm);
  }

  .pagination-btn:hover {
    background: var(--light-gray);
  }

  .pagination-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }

  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .loading-skeleton {
    background: linear-gradient(90deg, var(--light-gray-2) 25%, var(--light-gray) 50%, var(--light-gray-2) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  .skeleton-text {
    height: 1rem;
    border-radius: var(--radius-sm);
    margin-bottom: 0.5rem;
  }

  .skeleton-title {
    height: 1.5rem;
    width: 60%;
    border-radius: var(--radius-sm);
    margin-bottom: 1rem;
  }

  .skeleton-card {
    height: 120px;
    border-radius: var(--radius);
    margin-bottom: 1rem;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
  .form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--light-gray-2);
  }

  .form-actions .btn {
    min-width: 120px;
  }

  .btn-group {
    display: flex;
    gap: 0.5rem;
  }

  .btn-group .btn {
    border-radius: 0;
  }

  .btn-group .btn:first-child {
    border-radius: var(--radius) 0 0 var(--radius) var(--radius);
  }

  .btn-group .btn:last-child {
    border-radius: 0 var(--radius) var(--radius) 0;
  }

  .btn-group .btn:only-child {
    border-radius: var(--radius);
  }

  /* ========== ØªØ£Ø«ÙŠØ±Ø§Øª hover Ù…Ø­Ø³Ù†Ø© ========== */
  .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .btn:active {
    transform: translateY(0);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
  }

  /* ========== Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
  .btn.loading {
    position: relative;
    color: transparent !important;
    pointer-events: none;
  }

  .btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 16px;
    height: 16px;
    margin: -8px 0 0 -8px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ ========== */
  .table-actions-cell {
    white-space: nowrap;
  }

  .table-actions-cell .btn {
    margin: 0 0.25rem;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¥Ø¯Ø®Ø§Ù„ ========== */
  .input-group {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-group .form-input {
    flex: 1;
  }

  .input-group .input-addon {
    background: var(--light-gray);
    border: 2px solid var(--light-gray-2);
    border-right: none;
    padding: 0.875rem 1rem;
    border-radius: var(--radius) 0 0 var(--radius) var(--radius);
    color: var(--text-gray);
    font-size: var(--text-sm);
  }

  .input-group .form-input {
    border-radius: 0 var(--radius) var(--radius) 0;
  }

  .input-group .input-icon-right {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-gray);
    pointer-events: none;
  }

  /* ========== Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ========== */
  .form-error {
    color: var(--danger);
    font-size: var(--text-xs);
    margin-top: 0.25rem;
    display: none;
  }

  .form-error.show {
    display: block;
  }

  .form-input.error {
    border-color: var(--danger);
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ========== */
  .card-hover {
    transition: var(--transition);
  }

  .card-hover:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow);
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… ========== */
  .list-group {
    background: var(--bg-card);
    border-radius: var(--radius);
    overflow: hidden;
    border: 1px solid var(--light-gray-2);
  }

  .list-item {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--light-gray-2);
    transition: var(--transition);
    cursor: pointer;
  }

  .list-item:last-child {
    border-bottom: none;
  }

  .list-item:hover {
    background: var(--light-gray);
  }

  .list-item.active {
    background: rgba(59, 130, 246, 0.1);
    border-right: 3px solid var(--primary);
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ ========== */

  /* ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„ØµØºÙŠØ±Ø© */
  .user-avatar-small {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: var(--transition);
  }

  .user-avatar-small:hover {
    transform: scale(1.1);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ */
  .data-table tbody tr {
    transition: var(--transition);
  }

  .data-table tbody tr:hover {
    background: var(--light-gray);
    transform: translateX(2px);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¨Ø§Ø¯Ø¬Ø§Øª */
  .badge {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: var(--transition);
  }

  .badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµØºÙŠØ±Ø© */
  .btn-sm {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: var(--transition);
  }

  .btn-sm:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªØ§Ø±ÙŠØ® */
  .date-display {
    background: var(--light-gray);
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    font-size: var(--text-xs);
    color: var(--text-dark);
    border-right: 3px solid var(--primary);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ÙØ§Ø±ØºØ© */
  .empty-value {
    color: var(--text-gray);
    font-style: italic;
    font-size: var(--text-xs);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
  .info-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 4px 8px;
    background: var(--light-gray);
    border-radius: var(--radius-sm);
    font-size: var(--text-sm);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªÙƒÙ„ÙØ© */
  .cost-cell {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
    padding: 6px 12px;
    border-radius: var(--radius);
    text-align: center;
    font-weight: 700;
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª */
  .notes-cell {
    max-width: 120px;
    padding: 6px 8px;
    background: var(--light-gray);
    border-radius: var(--radius);
    font-size: var(--text-xs);
    color: var(--text-dark);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    border-right: 3px solid var(--warning);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
  .user-cell {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 4px 8px;
    background: var(--light-gray);
    border-radius: var(--radius);
  }

  .user-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .user-name {
    font-weight: 600;
    color: var(--text-dark);
    font-size: var(--text-sm);
  }

  .user-email {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø¯ÙˆØ± */
  .role-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 4px 8px;
    background: var(--light-gray);
    border-radius: var(--radius);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø© */
  .status-cell {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 4px 8px;
    background: var(--light-gray);
    border-radius: var(--radius);
  }

  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® */
  .date-cell {
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 4px 8px;
    background: var(--light-gray);
    border-radius: var(--radius);
  }

  .date-value {
    font-weight: 600;
    color: var(--text-dark);
    font-size: var(--text-sm);
  }

  .date-label {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  .date-expiry {
    color: var(--warning);
    font-weight: 600;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªØ¬Ø§ÙˆØ¨ */
  @media (max-width: 1400px) {
    .data-table {
      font-size: 12px;
    }
    .data-table th,
    .data-table td {
      padding: 10px 8px;
    }
  }
  
  @media (max-width: 1200px) {
    .data-table {
      min-width: 1200px;
    }
  }
  
  /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØµØµ */
  .table-responsive::-webkit-scrollbar {
    height: 8px;
  }
  
  .table-responsive::-webkit-scrollbar-track {
    background: #f1f5f9;
  }
  
  .table-responsive::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #3b82f6, #8b5cf6);
    border-radius: 4px;
  }
  
  /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
  .report-table-container {
    max-height: 300px;
    overflow-y: auto;
  }
  
  .report-table-container table {
    width: 100%;
    min-width: 1000px;
  }
  
  /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
  .report-controls {
    display: flex;
    gap: 10px;
    margin: 15px 0;
    flex-wrap: wrap;
  }
  
  .report-controls .btn {
    flex: 1;
    min-width: 150px;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
  @media print {
    .report-controls,
    .no-print,
    .mobile-menu-toggle,
    .sidebar,
    .page-actions {
      display: none !important;
    }
    
    .main-content {
      margin-right: 0 !important;
      padding: 0 !important;
    }
    
    .page-content {
      box-shadow: none !important;
      border: none !important;
      padding: 0 !important;
    }
    
    .data-table {
      font-size: 10px !important;
    }
    
    .data-table th,
    .data-table td {
      padding: 4px 6px !important;
    }
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ========== */
  .logs-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .log-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--light-gray-2);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
  }

  .log-card:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow);
  }

  .log-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 4px;
    height: 100%;
    background: var(--primary);
  }

  .log-card.diesel::before {
    background: var(--accent);
  }

  .log-card.generator::before {
    background: var(--warning);
  }

  .log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--light-gray-2);
  }

  .log-operation-id {
    font-size: var(--text-sm);
    font-weight: 700;
    color: var(--primary);
  }

  .log-date-time {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
  }

  .log-date {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  .log-time {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  .log-vehicle-info {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .log-plate {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
  }

  .log-vehicle-type {
    padding: 0.25rem 0.5rem;
    border-radius: 20px;
    font-size: var(--text-xs);
    font-weight: 600;
  }

  .log-driver {
    font-size: var(--text-sm);
    color: var(--text-gray);
    margin-bottom: 0.75rem;
  }

  .log-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin-bottom: 1rem;
  }

  .log-detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .log-detail-label {
    font-size: var(--text-xs);
    color: var(--text-gray);
  }

  .log-detail-value {
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--text-dark);
  }

  .log-cost {
    background: linear-gradient(135deg, var(--danger), #dc2626);
    color: white;
    padding: 0.75rem;
    border-radius: var(--radius);
    text-align: center;
    margin-bottom: 1rem;
  }

  .log-cost-label {
    font-size: var(--text-xs);
    opacity: 0.9;
  }

  .log-cost-value {
    font-size: var(--text-lg);
    font-weight: 700;
  }

  .log-actions {
    display: flex;
    gap: 0.5rem;
  }

  .log-action-btn {
    flex: 1;
    padding: 0.5rem;
    border-radius: var(--radius);
    font-size: var(--text-xs);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
  }

  .log-action-btn.preview {
    background: var(--primary);
    color: white;
  }

  .log-action-btn.preview:hover {
    background: var(--primary-dark);
  }

  .log-action-btn.print {
    background: var(--success);
    color: white;
  }

  .log-action-btn.print:hover {
    background: #059669;
  }

  .log-action-btn.delete {
    background: var(--danger);
    color: white;
  }

  .log-action-btn.delete:hover {
    background: #dc2626;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ± */
  .report-stats-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .report-stat-card {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--light-gray-2);
    text-align: center;
  }

  .report-stat-icon {
    width: 3rem;
    height: 3rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    color: white;
    font-size: 1.25rem;
  }

  .report-stat-value {
    font-size: var(--text-2xl);
    font-weight: 800;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
  }

  .report-stat-label {
    font-size: var(--text-sm);
    color: var(--text-gray);
  }

  .report-chart-container {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--light-gray-2);
    margin-bottom: 2rem;
  }

  .report-chart-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1rem;
    text-align: center;
  }

  .report-chart-placeholder {
    height: 300px;
    background: var(--light-gray);
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-gray);
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„ÙŠÙˆÙ…ÙŠØ© */
  .date-filter-tabs {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    border-bottom: 1px solid var(--light-gray-2);
  }

  .date-filter-tab {
    padding: 0.75rem 1rem;
    background: transparent;
    border: none;
    color: var(--text-gray);
    font-weight: 600;
    cursor: pointer;
    position: relative;
    transition: var(--transition);
  }

  .date-filter-tab:hover {
    color: var(--primary);
  }

  .date-filter-tab.active {
    color: var(--primary);
  }

  .date-filter-tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 100%;
    height: 2px;
    background: var(--primary);
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
  .print-header {
    text-align: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #4f46e5;
  }
  
  .print-header img {
    max-width: 150px;
    height: auto;
    margin-bottom: 10px;
  }
  
  .print-header h1 {
    color: #4f46e5;
    margin-bottom: 5px;
  }
  
  .print-header .subtitle {
    color: #666;
    font-size: 14px;
  }
  
  .print-summary {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .summary-card {
    background: #f8fafc;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 15px;
    text-align: center;
  }
  
  .summary-value {
    font-size: 24px;
    font-weight: 700;
    color: #4f46e5;
    margin-bottom: 5px;
  }
  
  .summary-label {
    font-size: 12px;
    color: #64748b;
  }
  
  .print-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  
  .print-table th {
    background: #4f46e5;
    color: white;
    padding: 12px 8px;
    text-align: right;
    font-size: 12px;
    border: 1px solid #4338ca;
  }
  
  .print-table td {
    padding: 10px 8px;
    border: 1px solid #e2e8f0;
    font-size: 11px;
  }
  
  .print-footer {
    margin-top: 30px;
    padding-top: 15px;
    border-top: 1px dashed #cbd5e1;
    text-align: center;
    font-size: 11px;
    color: #64748b;
  }

  /* ========== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ========== */
  .logs-table-container {
    background: var(--bg-card);
    border-radius: var(--radius);
    overflow: hidden;
    border: 1px solid var(--light-gray-2);
    margin-top: 2rem;
  }

  .logs-table-header {
    padding: 1.5rem;
    background: var(--light-gray);
    border-bottom: 1px solid var(--light-gray-2);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .logs-table-title {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .logs-table-actions {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .logs-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--text-sm);
  }

  .logs-table thead {
    background: linear-gradient(90deg, var(--primary-dark), var(--primary));
  }

  .logs-table th {
    padding: 1.25rem;
    text-align: right;
    font-weight: 600;
    color: white;
    white-space: nowrap;
    font-size: var(--text-sm);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .logs-table tbody tr {
    border-bottom: 1px solid var(--light-gray-2);
    transition: var(--transition);
  }

  .logs-table tbody tr:hover {
    background: var(--light-gray);
    transform: translateX(2px);
  }

  .logs-table td {
    padding: 1.25rem;
    color: var(--text-dark);
    vertical-align: middle;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© */
  .advanced-filters {
    background: var(--bg-card);
    border-radius: var(--radius);
    padding: 1.5rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow-sm);
    margin-bottom: 2rem;
  }

  .filter-row {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  .filter-col {
    flex: 1;
    min-width: 200px;
  }

  .filter-actions {
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
    margin-top: 1rem;
  }

  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
  .invoice-preview {
    background: var(--bg-card);
    border-radius: var(--radius-lg);
    padding: 2rem;
    border: 1px solid var(--light-gray-2);
    box-shadow: var(--shadow);
    margin: 2rem 0;
    position: relative;
    overflow: hidden;
  }

  .invoice-preview::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 6px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
  }

  .invoice-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--light-gray-2);
  }

  .invoice-title {
    font-size: var(--text-2xl);
    font-weight: 800;
    color: var(--primary);
  }

  .invoice-number {
    font-size: var(--text-lg);
    font-weight: 700;
    color: var(--text-dark);
  }

  .invoice-section {
    margin-bottom: 1.5rem;
  }

  .invoice-section-title {
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--light-gray-2);
  }

  .invoice-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
  }

  .invoice-detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .invoice-detail-label {
    font-size: var(--text-sm);
    color: var(--text-gray);
    font-weight: 600;
  }

  .invoice-detail-value {
    font-size: var(--text-base);
    color: var(--text-dark);
    font-weight: 700;
  }

  .invoice-total {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
    padding: 1.5rem;
    border-radius: var(--radius);
    text-align: center;
    margin-top: 1.5rem;
  }

  .invoice-total-label {
    font-size: var(--text-base);
    font-weight: 600;
    margin-bottom: 0.5rem;
  }

  .invoice-total-value {
    font-size: var(--text-3xl);
    font-weight: 800;
  }

  .invoice-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
  }

</style>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <div id="loginContainer" class="login-container">
    <div class="login-grid">
      <div class="login-side">
        <img src="https://adiyatdist.com/wp-content/uploads/2024/12/logo-horizontal.png" 
             alt="Ø´Ø¹Ø§Ø± Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª" class="login-logo">
        <h1 class="login-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯</h1>
        <p class="login-subtitle">Ø§Ù„Ø­Ù„ Ø§Ù„Ø£Ù…Ø«Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ§Ù„ÙˆÙ‚ÙˆØ¯</p>
        
        <div class="login-features">
          <div class="feature">
            <i class="fas fa-bolt"></i>
            <span>Ø¥Ø¯Ø§Ø±Ø© Ø°ÙƒÙŠØ© Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ§Ù„ÙˆÙ‚ÙˆØ¯</span>
          </div>
          <div class="feature">
            <i class="fas fa-chart-line"></i>
            <span>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
          </div>
          <div class="feature">
            <i class="fas fa-shield-alt"></i>
            <span>Ù†Ø¸Ø§Ù… Ø¢Ù…Ù† ÙˆÙ…Ø´ÙØ±</span>
          </div>
          <div class="feature">
            <i class="fas fa-mobile-alt"></i>
            <span>ÙŠØ¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</span>
          </div>
        </div>
      </div>
      
      <div class="login-content">
        <h2 style="font-size: var(--text-2xl); font-weight: 700; color: var(--text-dark); margin-bottom: 2rem;">
          <i class="fas fa-sign-in-alt" style="color: var(--primary); margin-left: 0.5rem;"></i>
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…
        </h2>
        
        <form id="loginForm" class="login-form">
          <div class="form-group">
            <label class="form-label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
            <div class="input-group">
              <input type="email" id="loginEmail" class="form-input" placeholder="example@adiyat.com" required>
              <div class="input-icon">
                <i class="fas fa-envelope"></i>
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
            <div class="input-group">
              <input type="password" id="loginPassword" class="form-input" placeholder="********" required>
              <div class="input-icon">
                <i class="fas fa-lock"></i>
              </div>
              <button type="button" class="password-toggle" id="togglePassword">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          
          <div id="loginError" class="login-error">
            <i class="fas fa-exclamation-circle"></i>
            <span>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</span>
          </div>
          
          <button type="submit" class="login-btn">
            <i class="fas fa-sign-in-alt"></i>
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
          </button>
        </form>
        
        <div style="margin-top: 2rem; text-align: center; color: var(--text-gray); font-size: var(--text-sm);">
          <i class="fas fa-code" style="margin-left: 0.5rem;"></i>
          Developed by Ammar Kanna
        </div>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù…Ø¹ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
  <div id="mainContent" class="app-container hidden">
    <!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø¬ÙˆØ§Ù„ -->
    <button class="mobile-menu-toggle" id="mobileMenuToggle">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <img src="https://adiyatdist.com/wp-content/uploads/2024/12/logo-horizontal.png" 
             alt="Ø´Ø¹Ø§Ø± Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª" class="sidebar-logo">
        <div class="sidebar-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯</div>
        <div class="sidebar-subtitle">Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª Ù„Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</div>
      </div>
      
      <div class="nav-menu">
        <div class="nav-item active" data-page="dashboard">
          <i class="fas fa-tachometer-alt"></i>
          <span class="nav-item-text">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</span>
        </div>
        
        <div class="nav-item" data-page="vehicles" data-permission="manageVehicles">
          <i class="fas fa-car"></i>
          <span class="nav-item-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</span>
          <span class="nav-badge" id="vehiclesCount">0</span>
        </div>
        
        <div class="nav-item" data-page="fuel" data-permission="dispenseFuel">
          <i class="fas fa-gas-pump"></i>
          <span class="nav-item-text">ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯</span>
        </div>
        
        <div class="nav-item" data-page="history" data-permission="viewReports">
          <i class="fas fa-history"></i>
          <span class="nav-item-text">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
          <span class="nav-badge" id="logsCount">0</span>
        </div>
        
        <div class="nav-item" data-page="users" data-permission="manageUsers" id="usersMenuItem">
          <i class="fas fa-users-cog"></i>
          <span class="nav-item-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
        </div>
      </div>
      
      <div class="sidebar-footer">
        <div class="user-info-sidebar">
          <div class="user-avatar-sidebar" id="userAvatarSidebar">Ù…</div>
          <div class="user-details-sidebar">
            <div class="user-name-sidebar" id="userNameSidebar">Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯</div>
            <div class="user-role-sidebar" id="userRoleSidebar">Ù…Ø¯ÙŠØ±</div>
          </div>
        </div>
        
        <button class="logout-btn-sidebar" id="logoutBtnSidebar">
          <i class="fas fa-sign-out-alt"></i>
          ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        </button>
      </div>
    </div>

    <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="main-content">
      <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
      <div id="dashboardPage" class="page-content">
        <div class="page-header">
          <div>
            <h1 class="page-title">
              <i class="fas fa-tachometer-alt"></i>
              Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </h1>
            <p class="page-subtitle">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ø§Ù„Ù…ØªØ·ÙˆØ±</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary" onclick="refreshDashboard()">
              <i class="fas fa-sync-alt"></i>
              ØªØ­Ø¯ÙŠØ«
            </button>
          </div>
        </div>
        
        <div class="dashboard-page">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-car"></i>
            </div>
            <div class="stat-value" id="dashboardVehiclesCount">0</div>
            <div class="stat-label">Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              <span>Ø²ÙŠØ§Ø¯Ø© Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-gas-pump"></i>
            </div>
            <div class="stat-value" id="dashboardFuelToday">0</div>
            <div class="stat-label">Ù„ØªØ±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              <span>Ø²ÙŠØ§Ø¯Ø© Ø¹Ù† Ø§Ù„Ø£Ù…Ø³</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <div class="stat-value" id="dashboardCostToday">0</div>
            <div class="stat-label">ØªÙƒÙ„ÙØ© Ø§Ù„ÙŠÙˆÙ…</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              <span>Ø²ÙŠØ§Ø¯Ø© Ø¹Ù† Ø§Ù„Ø£Ù…Ø³</span>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="stat-value" id="dashboardEfficiency">0%</div>
            <div class="stat-label">ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
            <div class="stat-change positive">
              <i class="fas fa-arrow-up"></i>
              <span>ØªØ­Ø³Ù† Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª -->
      <div id="vehiclesPage" class="page-content hidden">
        <div class="page-header">
          <div>
            <h1 class="page-title">
              <i class="fas fa-car"></i>
              Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
            </h1>
            <p class="page-subtitle">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ÙˆØ§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" id="btnAddVehicle" data-permission="manageVehicles">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
            </button>
            <button class="btn btn-warning" id="btnClearVehicleForm" data-permission="manageVehicles">
              <i class="fas fa-eraser"></i>
              Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            </button>
            <button class="btn btn-primary" onclick="loadVehiclesList()" data-permission="manageVehicles">
              <i class="fas fa-sync-alt"></i>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
          </div>
        </div>
        
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
        <div class="stats-grid">
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-car"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="totalVehicles">0</div>
              <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-gas-pump"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="activeVehicles">0</div>
              <div class="stat-label-mini">Ù…Ø±ÙƒØ¨Ø§Øª Ù†Ø´Ø·Ø©</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="totalDrivers">0</div>
              <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-building"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="totalBranches">0</div>
              <div class="stat-label-mini">Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
            </div>
          </div>
        </div>
        
        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙƒØ¨Ø© -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-edit"></i>
            Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø±ÙƒØ¨Ø©
          </h2>
          
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-car-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
              </label>
              <input type="text" id="v_plate" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø® Ùˆ 1234">
              <div class="form-error" id="v_plate_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚
              </label>
              <input type="text" id="v_driver" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ">
              <div class="form-error" id="v_driver_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
              </label>
              <input type="tel" id="v_phone" class="form-input" placeholder="Ù…Ø«Ø§Ù„: 0912345678">
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„
              </label>
              <input type="number" id="v_init_odo" class="form-input" placeholder="Ù…Ø«Ø§Ù„: 150000">
              <div class="form-error" id="v_init_odo_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£ÙˆÙ„</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-gas-pump"></i> Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
              </label>
              <input type="number" id="v_kpl" class="form-input" placeholder="Ù…Ø«Ø§Ù„: 8.5" step="0.1">
              <div class="form-error" id="v_kpl_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-car"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
              </label>
              <select id="v_type" class="form-select">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹</option>
                <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
                <option value="Ø¬Ø§Ø²">Ø¬Ø§Ø²</option>
                <option value="Ù…ÙˆÙ„Ø¯">Ù…ÙˆÙ„Ø¯</option>
              </select>
              <div class="form-error" id="v_type_error">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…
              </label>
              <select id="v_branch" class="form-select">
                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>
                <option value="Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
                <option value="Ø¹Ø·Ø¨Ø±Ø©">Ø¹Ø·Ø¨Ø±Ø©</option>
                <option value="Ø´Ù†Ø¯ÙŠ">Ø´Ù†Ø¯ÙŠ</option>
                <option value="Ø¯Ù†Ù‚Ù„Ø§">Ø¯Ù†Ù‚Ù„Ø§</option>
                <option value="Ø§Ù„Ø¯Ø¨Ø©">Ø§Ù„Ø¯Ø¨Ø©</option>
                <option value="Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†">Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†</option>
                <option value="ÙƒØ³Ù„Ø§">ÙƒØ³Ù„Ø§</option>
                <option value="Ø§Ù„Ù‚Ø¶Ø§Ø±Ù">Ø§Ù„Ù‚Ø¶Ø§Ø±Ù</option>
                <option value="Ù…Ø¯Ù†ÙŠ">Ù…Ø¯Ù†ÙŠ</option>
                <option value="ÙƒÙˆØ³ØªÙŠ">ÙƒÙˆØ³ØªÙŠ</option>
                <option value="Ø§Ù„Ø§Ø¨ÙŠØ¶">Ø§Ù„Ø§Ø¨ÙŠØ¶</option>
                <option value="Ø³Ù†Ø¬Ø©">Ø³Ù†Ø¬Ø©</option>
              </select>
              <div class="form-error" id="v_branch_error">ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù…</div>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-info-circle"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
              </label>
              <select id="v_status" class="form-select">
                <option value="Ù†Ø´Ø·">Ù†Ø´Ø·</option>
                <option value="ØºÙŠØ± Ù†Ø´Ø·">ØºÙŠØ± Ù†Ø´Ø·</option>
                <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                <option value="Ù…Ø³ØªØ£Ø¬Ø±">Ù…Ø³ØªØ£Ø¬Ø±</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„
              </label>
              <input type="date" id="v_registration_date" class="form-input">
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label">
                <i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª
              </label>
              <textarea id="v_notes" class="form-textarea" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ¨Ø©"></textarea>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-success" id="btnSaveVehicle" data-permission="manageVehicles">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
            </button>
            <button type="button" class="btn btn-warning" id="btnUpdateVehicle" style="display: none;" data-permission="manageVehicles">
              <i class="fas fa-edit"></i>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
            </button>
            <button type="button" class="btn btn-ghost" id="btnCancelEdit" style="display: none;" data-permission="manageVehicles">
              <i class="fas fa-times"></i>
              Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            </button>
          </div>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„Ø§ØªØ± -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-filter"></i>
            Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          </h2>
          
          <div class="search-box">
            <input type="text" id="searchVehicleInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ù„ÙˆØ­Ø© Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div class="filter-chips">
            <div class="filter-chip active" data-filter="all">
              <i class="fas fa-th"></i>
              Ø§Ù„ÙƒÙ„
            </div>
            <div class="filter-chip" data-filter="Ø¨Ù†Ø²ÙŠÙ†">
              <i class="fas fa-gas-pump"></i>
              Ø¨Ù†Ø²ÙŠÙ†
            </div>
            <div class="filter-chip" data-filter="Ø¬Ø§Ø²">
              <i class="fas fa-oil-can"></i>
              Ø¬Ø§Ø²
            </div>
            <div class="filter-chip" data-filter="Ù…ÙˆÙ„Ø¯">
              <i class="fas fa-bolt"></i>
              Ù…ÙˆÙ„Ø¯
            </div>
            <div class="filter-chip" data-filter="Ù†Ø´Ø·">
              <i class="fas fa-check-circle"></i>
              Ù†Ø´Ø·
            </div>
            <div class="filter-chip" data-filter="ØºÙŠØ± Ù†Ø´Ø·">
              <i class="fas fa-pause-circle"></i>
              ØºÙŠØ± Ù†Ø´Ø·
            </div>
          </div>
        </div>
        
        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-list"></i>
            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
          </h2>
          
          <div class="export-options">
            <button class="export-btn" onclick="exportVehicles()" data-permission="manageVehicles">
              <i class="fas fa-file-excel"></i>
              ØªØµØ¯ÙŠØ± Excel
            </button>
            <button class="export-btn" onclick="printVehicles()" data-permission="manageVehicles">
              <i class="fas fa-print"></i>
              Ø·Ø¨Ø§Ø¹Ø©
            </button>
            <button class="export-btn" onclick="importVehicles()" data-permission="manageVehicles">
              <i class="fas fa-file-import"></i>
              Ø§Ø³ØªÙŠØ±Ø§Ø¯
            </button>
          </div>
          
          <div class="table-container">
            <div class="table-responsive">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th><i class="fas fa-car-alt"></i> Ø§Ù„Ù„ÙˆØ­Ø©</th>
                    <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                    <th><i class="fas fa-phone"></i> Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th><i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…</th>
                    <th><i class="fas fa-car"></i> Ø§Ù„Ù†ÙˆØ¹</th>
                    <th><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                    <th><i class="fas fa-gas-pump"></i> ÙƒÙ…/Ù„ØªØ±</th>
                    <th><i class="fas fa-info-circle"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                    <th class="no-print"><i class="fas fa-cogs"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr>
                </thead>
                <tbody id="listVehicles">
                  <tr id="loadingVehiclesRow">
                    <td colspan="11">
                      <div class="loader">
                        <div class="spinner"></div>
                        <div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª...</div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Ø§Ù„ØªØµÙØ­ -->
          <div class="pagination" id="vehiclesPagination">
            <button class="pagination-btn" onclick="changeVehiclesPage('prev')">
              <i class="fas fa-chevron-right"></i>
            </button>
            <button class="pagination-btn active">1</button>
            <button class="pagination-btn">2</button>
            <button class="pagination-btn">3</button>
            <button class="pagination-btn" onclick="changeVehiclesPage('next')">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- ØµÙØ­Ø© ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯ - Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
      <div id="fuelPage" class="page-content hidden">
        <div class="page-header">
          <div>
            <h1 class="page-title">
              <i class="fas fa-gas-pump"></i>
              ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯
            </h1>
            <p class="page-subtitle">ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯ Ù„Ù„Ù…Ø±ÙƒØ¨Ø§Øª</p>
          </div>
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ -->
        <div class="data-summary">
          <div class="summary-item">
            <div class="summary-value" id="todayFuelCount">0</div>
            <div class="summary-label">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="todayFuelLiters">0</div>
            <div class="summary-label">Ù„ØªØ±Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="todayFuelCost">0</div>
            <div class="summary-label">ØªÙƒÙ„ÙØ© Ø§Ù„ÙŠÙˆÙ…</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="activeFuelVehicles">0</div>
            <div class="summary-label">Ù…Ø±ÙƒØ¨Ø§Øª Ù†Ø´Ø·Ø©</div>
          </div>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-search"></i>
            Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
          </h2>
          
          <div class="search-box">
            <input type="text" id="quickVehicleSearch" class="search-input" placeholder="Ø£Ø¯Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù„Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ -->
          <div id="quickSearchResults" style="margin-top: 1rem; display: none;">
            <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‡Ù†Ø§ -->
          </div>
        </div>
        
        <!-- ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-download"></i>
            ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
          </h2>
          
          <div class="form-grid">
            <div class="form-group" style="grid-column: 1 / -1;">
              <label class="form-label">
                <i class="fas fa-search"></i> Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
              </label>
              <input type="text" id="f_plate" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©">
              <div class="form-error" id="f_plate_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1; text-align: center;">
              <button class="btn btn-accent btn-lg" id="btnLoadVehicle" data-permission="dispenseFuel">
                <i class="fas fa-download"></i>
                ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
              </button>
            </div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø© -->
        <div id="sectionLoaded" class="hidden" style="margin-top: 1.5rem;">
          <div class="divider"></div>
          
          <div class="form-section">
            <h2 class="section-title">
              <i class="fas fa-edit"></i>
              Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØµØ±Ù
            </h2>
            
            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-user"></i> Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚
                </label>
                <input type="text" id="f_driver" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-car"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                </label>
                <div id="f_type_display" class="form-input" style="display: flex; align-items: center; justify-content: space-between;">
                  <span id="f_type_text">Ø¨Ù†Ø²ÙŠÙ†</span>
                  <span id="f_type_badge" class="vehicle-type type-petrol">
                    <i class="fas fa-gas-pump"></i> Ø¨Ù†Ø²ÙŠÙ†
                  </span>
                </div>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
                </label>
                <input type="text" id="f_prev" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-gas-pump"></i> Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
                </label>
                <input type="text" id="f_kpl" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                </label>
                <input type="date" id="f_date" class="form-input">
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-clock"></i> ÙˆÙ‚Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
                </label>
                <input type="time" id="f_time" class="form-input">
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯
                </label>
                <input type="number" id="f_curr" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                <div class="form-error" id="f_curr_error">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</div>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-road"></i> Ø§Ù„Ù…Ø³Ø§ÙØ©
                </label>
                <input type="text" id="f_distance" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-oil-can"></i> ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆÙ‚ÙˆØ¯ (Ù„ØªØ±)
                </label>
                <input type="text" id="f_liters" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-gas-pump"></i> ÙƒÙ…ÙŠØ© Ø§Ù„ÙˆÙ‚ÙˆØ¯ (Ø¬Ø§Ù„ÙˆÙ†)
                </label>
                <input type="text" id="f_gallons" class="form-input" readonly>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-money-bill-wave"></i> Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±
                </label>
                <input type="number" id="f_price" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø¹Ø±" step="0.01">
                <div class="form-error" id="f_price_error">ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</div>
              </div>
              
              <div class="form-group">
                <label class="form-label">
                  <i class="fas fa-calculator"></i> Ø§Ù„ØªÙƒÙ„ÙØ©
                </label>
                <input type="text" id="f_cost" class="form-input" readonly>
              </div>
              
              <div class="form-group" style="grid-column: 1 / -1;">
                <label class="form-label">
                  <i class="fas fa-sticky-note"></i> Ù…Ù„Ø§Ø­Ø¸Ø§Øª
                </label>
                <input type="text" id="f_notes" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø±Ø­Ù„Ø© Ø¯Ù†Ù‚Ù„Ø§">
              </div>
            </div>
          </div>
          
          <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
          <div class="form-actions">
            <button class="btn btn-success" id="saveFuelBtnBottom" data-permission="dispenseFuel">
              <i class="fas fa-check-circle"></i>
              Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            </button>
            <button class="btn btn-warning" id="previewInvoiceBtnBottom" data-permission="dispenseFuel">
              <i class="fas fa-eye"></i>
              Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            </button>
            <button class="btn btn-danger" id="clearFuelBtnBottom" data-permission="dispenseFuel">
              <i class="fas fa-eraser"></i>
              Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            </button>
          </div>
        </div>
        
        <!-- Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø§Ù„Ø¬Ø¯ÙŠØ¯) -->
        <div class="form-section" style="margin-top: 2rem;">
          <div class="table-header">
            <div class="table-title">
              <i class="fas fa-list"></i>
              Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
            </div>
            <div class="table-actions">
              <input type="date" id="dailyFuelDateFilter" class="form-input" style="width: auto;">
              <button class="btn btn-primary btn-sm" onclick="loadFuelDailyTable()">
                <i class="fas fa-search"></i> Ø¹Ø±Ø¶
              </button>
              <button class="btn btn-success btn-sm" onclick="exportDailyFuelToExcel()">
                <i class="fas fa-file-excel"></i> Excel
              </button>
              <button class="btn btn-accent btn-sm" onclick="printDailyFuelTable()">
                <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
              </button>
            </div>
          </div>
          
          <div class="table-container">
            <div class="table-responsive">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th><i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª</th>
                    <th><i class="fas fa-car-alt"></i> Ø§Ù„Ù„ÙˆØ­Ø©</th>
                    <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                    <th><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</th>
                    <th><i class="fas fa-road"></i> Ø§Ù„Ù…Ø³Ø§ÙØ©</th>
                    <th><i class="fas fa-gas-pump"></i> Ø§Ù„Ù„ØªØ±Ø§Øª</th>
                    <th><i class="fas fa-money-bill"></i> Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                  </tr>
                </thead>
                <tbody id="dailyFuelTableBody">
                  <tr>
                    <td colspan="8">
                      <div class="loader">
                        <div class="spinner"></div>
                        <div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª - Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
      <div id="historyPage" class="page-content hidden">
        <div class="page-header">
          <div>
            <h1 class="page-title">
              <i class="fas fa-history"></i>
              Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            </h1>
            <p class="page-subtitle">Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØªÙ‚ÙŠÙŠÙ… Ø£Ø¯Ø§Ø¡ Ø£Ø³Ø·ÙˆÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-primary" onclick="loadLogs()" data-permission="viewReports">
              <i class="fas fa-sync-alt"></i>
              ØªØ­Ø¯ÙŠØ«
            </button>
            <button class="btn btn-warning" onclick="clearFilters()" data-permission="viewReports">
              <i class="fas fa-times"></i>
              Ù…Ø³Ø­ Ø§Ù„ÙÙ„Ø§ØªØ±
            </button>
          </div>
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="data-summary">
          <div class="summary-item">
            <div class="summary-value" id="totalOperations">0</div>
            <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="totalLiters">0</div>
            <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ØªØ±Ø§Øª</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="totalCost">0</div>
            <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</div>
          </div>
          <div class="summary-item">
            <div class="summary-value" id="avgConsumption">0</div>
            <div class="summary-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
          </div>
        </div>
        
        <!-- Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© (ØªÙ… ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„ØªÙƒÙˆÙ† Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙ‚Ø·) -->
        <div class="advanced-filters">
          <h2 class="section-title">
            <i class="fas fa-filter"></i>
            ÙÙ„Ø§ØªØ± Ø§Ù„Ø¨Ø­Ø«
          </h2>
          
          <!-- Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙ‚Ø· (Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¸Ø§Ù‡Ø±Ø©) -->
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calendar-alt"></i> Ù…Ù† ØªØ§Ø±ÙŠØ®
              </label>
              <input type="date" id="filterDateFrom" class="form-input">
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calendar-alt"></i> Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®
              </label>
              <input type="date" id="filterDateTo" class="form-input">
            </div>
          </div>
          
          <div class="filter-row">
            <div class="filter-col">
              <label class="form-label">
                <i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…
              </label>
              <select id="filterBranch" class="form-select">
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</option>
                <option value="Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
                <option value="Ø¹Ø·Ø¨Ø±Ø©">Ø¹Ø·Ø¨Ø±Ø©</option>
                <option value="Ø´Ù†Ø¯ÙŠ">Ø´Ù†Ø¯ÙŠ</option>
                <option value="Ø¯Ù†Ù‚Ù„Ø§">Ø¯Ù†Ù‚Ù„Ø§</option>
                <option value="Ø§Ù„Ø¯Ø¨Ø©">Ø§Ù„Ø¯Ø¨Ø©</option>
                <option value="Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†">Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†</option>
                <option value="ÙƒØ³Ù„Ø§">ÙƒØ³Ù„Ø§</option>
                <option value="Ø§Ù„Ù‚Ø¶Ø§Ø±Ù">Ø§Ù„Ù‚Ø¶Ø§Ø±Ù</option>
                <option value="Ù…Ø¯Ù†ÙŠ">Ù…Ø¯Ù†ÙŠ</option>
                <option value="ÙƒÙˆØ³ØªÙŠ">ÙƒÙˆØ³ØªÙŠ</option>
                <option value="Ø§Ù„Ø§Ø¨ÙŠØ¶">Ø§Ù„Ø§Ø¨ÙŠØ¶</option>
                <option value="Ø³Ù†Ø¬Ø©">Ø³Ù†Ø¬Ø©</option>
              </select>
            </div>
            
            <div class="filter-col">
              <label class="form-label">
                <i class="fas fa-car"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
              </label>
              <select id="filterVehicleType" class="form-select">
                <option value="all">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                <option value="Ø¨Ù†Ø²ÙŠÙ†">Ø¨Ù†Ø²ÙŠÙ†</option>
                <option value="Ø¬Ø§Ø²">Ø¬Ø§Ø²</option>
                <option value="Ù…ÙˆÙ„Ø¯">Ù…ÙˆÙ„Ø¯</option>
              </select>
            </div>
            
            <div class="filter-col">
              <label class="form-label">
                <i class="fas fa-user"></i> Ø§Ù„Ø³Ø§Ø¦Ù‚
              </label>
              <input type="text" id="filterDriver" class="form-input" placeholder="Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚">
            </div>
            
            <div class="filter-col">
              <label class="form-label">
                <i class="fas fa-car-alt"></i> Ø§Ù„Ù„ÙˆØ­Ø©
              </label>
              <input type="text" id="filterPlate" class="form-input" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©">
            </div>
          </div>
          
          <div class="filter-actions">
            <button class="btn btn-primary" id="btnFilterLogs" data-permission="viewReports">
              <i class="fas fa-filter"></i>
              ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ±
            </button>
            <button class="btn btn-success" id="btnExport" data-permission="viewReports">
              <i class="fas fa-file-export"></i>
              ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>
          </div>
        </div>
        
        <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ù…Ø­Ø³Ù† -->
        <div class="logs-table-container">
          <div class="logs-table-header">
            <div class="logs-table-title">
              <i class="fas fa-list"></i>
              Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
            </div>
            <div class="logs-table-actions">
              <button class="btn btn-sm btn-primary" onclick="refreshLogs()" data-permission="viewReports">
                <i class="fas fa-sync-alt"></i>
                ØªØ­Ø¯ÙŠØ«
              </button>
              <button class="btn btn-sm btn-success" onclick="printLogsTable()" data-permission="viewReports">
                <i class="fas fa-print"></i>
                Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
              </button>
            </div>
          </div>
          
          <div class="table-responsive">
            <table class="logs-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                  <th><i class="fas fa-clock"></i> Ø§Ù„ÙˆÙ‚Øª</th>
                  <th><i class="fas fa-car-alt"></i> Ø§Ù„Ù„ÙˆØ­Ø©</th>
                  <th><i class="fas fa-user"></i> Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                  <th><i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…</th>
                  <th><i class="fas fa-car"></i> Ø§Ù„Ù†ÙˆØ¹</th>
                  <th><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
                  <th><i class="fas fa-tachometer-alt"></i> Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</th>
                  <th><i class="fas fa-road"></i> Ø§Ù„Ù…Ø³Ø§ÙØ©</th>
                  <th><i class="fas fa-gas-pump"></i> Ø§Ù„Ù„ØªØ±Ø§Øª</th>
                  <th><i class="fas fa-money-bill"></i> Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                  <th class="no-print"><i class="fas fa-cogs"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
              </thead>
              <tbody id="logsTableBody">
                <tr>
                  <td colspan="14">
                    <div class="loader">
                      <div class="spinner"></div>
                      <div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <!-- Ø§Ù„ØªØµÙØ­ -->
          <div class="pagination" id="logsPagination">
            <button class="pagination-btn" onclick="changeLogsPage('prev')">
              <i class="fas fa-chevron-right"></i>
            </button>
            <button class="pagination-btn active">1</button>
            <button class="pagination-btn">2</button>
            <button class="pagination-btn">3</button>
            <button class="pagination-btn" onclick="changeLogsPage('next')">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
        </div>
        
        <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø© -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-chart-bar"></i>
            Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù…ÙØµÙ„Ø©
          </h2>
          
          <div class="stats-grid">
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-chart-bar"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statCount">0</div>
                <div class="stat-label-mini">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
            </div>
            </div>
            
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-route"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statDistance">0</div>
                <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
              </div>
            </div>
            
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-gas-pump"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statLiters">0</div>
                <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ØªØ±Ø§Øª</div>
              </div>
            </div>
            
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-money-bill-wave"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statCost">0</div>
                <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</div>
              </div>
            </div>
            
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-tachometer-alt"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statAvgKpl">0</div>
                <div class="stat-label-mini">Ù…ØªÙˆØ³Ø· ÙƒÙØ§Ø¡Ø©</div>
              </div>
            </div>
            
            <div class="stat-card-mini">
              <div class="stat-icon-mini">
                <i class="fas fa-calculator"></i>
              </div>
              <div class="stat-content">
                <div class="stat-value-mini" id="statAvgCost">0</div>
                <div class="stat-label-mini">Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©/ÙƒÙ…</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
      <div id="usersPage" class="page-content hidden">
        <div class="page-header">
          <div>
            <h1 class="page-title">
              <i class="fas fa-users-cog"></i>
              Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
            </h1>
            <p class="page-subtitle">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
          </div>
          <div class="page-actions">
            <button class="btn btn-success" onclick="openUserModal()" data-permission="manageUsers">
              <i class="fas fa-user-plus"></i>
              Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
            </button>
            <button class="btn btn-primary" onclick="loadUsersList()" data-permission="manageUsers">
              <i class="fas fa-sync-alt"></i>
              ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
          </div>
        </div>
        
        <!-- Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ -->
        <div class="stats-grid">
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="totalUsers">0</div>
              <div class="stat-label-mini">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="activeUsers">0</div>
              <div class="stat-label-mini">Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù†Ø´Ø·ÙŠÙ†</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-user-shield"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="managersCount">0</div>
              <div class="stat-label-mini">Ù…Ø¯ÙŠØ±ÙŠÙ†</div>
            </div>
          </div>
          
          <div class="stat-card-mini">
            <div class="stat-icon-mini">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="stat-content">
              <div class="stat-value-mini" id="supervisorsCount">0</div>
              <div class="stat-label-mini">Ù…Ø´Ø±ÙÙŠÙ†</div>
            </div>
          </div>
        </div>
        
        <!-- Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-search"></i>
            Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          </h2>
          
          <div class="search-box">
            <input type="text" id="searchUsers" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø§Ù„Ø¯ÙˆØ± Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div class="filter-chips">
            <div class="filter-chip active" data-filter="all">
              <i class="fas fa-th"></i>
              Ø§Ù„ÙƒÙ„
            </div>
            <div class="filter-chip" data-filter="Ù…Ø¯ÙŠØ±">
              <i class="fas fa-user-cog"></i>
              Ù…Ø¯ÙŠØ±ÙŠÙ†
            </div>
            <div class="filter-chip" data-filter="Ù…Ø´Ø±Ù">
              <i class="fas fa-user-shield"></i>
              Ù…Ø´Ø±ÙÙŠÙ†
            </div>
            <div class="filter-chip" data-filter="Ù…Ø³ØªØ®Ø¯Ù…">
              <i class="fas fa-user-tie"></i>
              Ø¶Ø¨Ø§Ø· Ø­Ø±ÙƒØ©
            </div>
            <div class="filter-chip" data-filter="active">
              <i class="fas fa-check-circle"></i>
              Ù†Ø´Ø·
            </div>
            <div class="filter-chip" data-filter="suspended">
              <i class="fas fa-pause-circle"></i>
              Ù…ÙˆÙ‚ÙˆÙ
            </div>
          </div>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div class="form-section">
          <h2 class="section-title">
            <i class="fas fa-users"></i>
            Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
          </h2>
          
          <div class="export-options">
            <button class="export-btn" onclick="exportUsersToExcel()" data-permission="manageUsers">
              <i class="fas fa-file-excel"></i>
              ØªØµØ¯ÙŠØ± Excel
            </button>
            <button class="export-btn" onclick="printUsers()" data-permission="manageUsers">
              <i class="fas fa-print"></i>
              Ø·Ø¨Ø§Ø¹Ø©
            </button>
          </div>
          
          <div class="table-container">
            <div class="table-responsive">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>#</th>
                    <th><i class="fas fa-user"></i> Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                    <th><i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                    <th><i class="fas fa-shield-alt"></i> Ø§Ù„Ø¯ÙˆØ±</th>
                    <th><i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…</th>
                    <th><i class="fas fa-phone"></i> Ø§Ù„Ù‡Ø§ØªÙ</th>
                    <th><i class="fas fa-user-check"></i> Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th><i class="fas fa-calendar"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th>
                    <th><i class="fas fa-clock"></i> Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                    <th class="no-print"><i class="fas fa-cogs"></i> Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <tr id="loadingUsersRow">
                    <td colspan="10">
                      <div class="loader">
                        <div class="spinner"></div>
                        <div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Ø§Ù„ØªØµÙØ­ -->
          <div class="pagination" id="usersPagination">
            <button class="pagination-btn" onclick="changeUsersPage('prev')">
              <i class="fas fa-chevron-right"></i>
            </button>
            <button class="pagination-btn active">1</button>
            <button class="pagination-btn">2</button>
            <button class="pagination-btn">3</button>
            <button class="pagination-btn" onclick="changeUsersPage('next')">
              <i class="fas fa-chevron-left"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
  <div id="alertsContainer"></div>

  <!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… -->
  <div id="userModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="userModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
        <button class="modal-close" onclick="closeUserModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <form id="userForm">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
              </label>
              <input type="text" id="userName" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
              </label>
              <input type="email" id="userEmail" class="form-input" placeholder="example@adiyat.com" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-lock"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
              </label>
              <input type="password" id="userPassword" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-phone"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
              </label>
              <input type="tel" id="userPhone" class="form-input" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-shield-alt"></i> Ø§Ù„Ø¯ÙˆØ±
              </label>
              <select id="userRole" class="form-select">
                <option value="Ù…Ø³ØªØ®Ø¯Ù…">Ø¶Ø§Ø¨Ø· Ø­Ø±ÙƒØ© ÙˆØªØ´ØºÙŠÙ„</option>
                <option value="Ù…Ø´Ø±Ù">Ù…Ø´Ø±Ù</option>
                <option value="Ù…Ø¯ÙŠØ±">Ù…Ø¯ÙŠØ±</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…
              </label>
              <select id="userBranch" class="form-select">
                <option value="Ø§Ù„Ø®Ø±Ø·ÙˆÙ…">Ø§Ù„Ø®Ø±Ø·ÙˆÙ…</option>
                <option value="Ø¹Ø·Ø¨Ø±Ø©">Ø¹Ø·Ø¨Ø±Ø©</option>
                <option value="Ø´Ù†Ø¯ÙŠ">Ø´Ù†Ø¯ÙŠ</option>
                <option value="Ø¯Ù†Ù‚Ù„Ø§">Ø¯Ù†Ù‚Ù„Ø§</option>
                <option value="Ø§Ù„Ø¯Ø¨Ø©">Ø§Ù„Ø¯Ø¨Ø©</option>
                <option value="Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†">Ø¨ÙˆØ±ØªØ³ÙˆØ¯Ø§Ù†</option>
                <option value="ÙƒØ³Ù„Ø§">ÙƒØ³Ù„Ø§</option>
                <option value="Ø§Ù„Ù‚Ø¶Ø§Ø±Ù">Ø§Ù„Ù‚Ø¶Ø§Ø±Ù</option>
                <option value="Ù…Ø¯Ù†ÙŠ">Ù…Ø¯Ù†ÙŠ</option>
                <option value="ÙƒÙˆØ³ØªÙŠ">ÙƒÙˆØ³ØªÙŠ</option>
                <option value="Ø§Ù„Ø§Ø¨ÙŠØ¶">Ø§Ù„Ø§Ø¨ÙŠØ¶</option>
                <option value="Ø³Ù†Ø¬Ø©">Ø³Ù†Ø¬Ø©</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calendar"></i> ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©
              </label>
              <input type="date" id="userExpiryDate" class="form-input">
            </div>
            
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-user-check"></i> Ø§Ù„Ø­Ø§Ù„Ø©
              </label>
              <select id="userStatus" class="form-select">
                <option value="active">Ù†Ø´Ø·</option>
                <option value="suspended">Ù…ÙˆÙ‚ÙˆÙ</option>
              </select>
            </div>
          </div>
          
          <!-- Ù‚Ø³Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª -->
          <div class="form-section" style="margin-top: 2rem;">
            <h2 class="section-title">
              <i class="fas fa-key"></i>
              Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            </h2>
            
            <div class="form-grid">
              <div class="form-group">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--light-gray); border-radius: var(--radius);">
                  <input type="checkbox" id="permManageVehicles" checked style="width: 1.25rem; height: 1.25rem; accent-color: var(--primary);">
                  <div>
                    <div style="font-weight: 600; color: var(--text-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</div>
                    <div style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø¥Ø¶Ø§ÙØ© ÙˆØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª</div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--light-gray); border-radius: var(--radius);">
                  <input type="checkbox" id="permDispenseFuel" checked style="width: 1.25rem; height: 1.25rem; accent-color: var(--primary);">
                  <div>
                    <div style="font-weight: 600; color: var(--text-dark);">ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯</div>
                    <div style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯</div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--light-gray); border-radius: var(--radius);">
                  <input type="checkbox" id="permViewReports" checked style="width: 1.25rem; height: 1.25rem; accent-color: var(--primary);">
                  <div>
                    <div style="font-weight: 600; color: var(--text-dark);">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
                    <div style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</div>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--light-gray); border-radius: var(--radius);">
                  <input type="checkbox" id="permManageUsers" style="width: 1.25rem; height: 1.25rem; accent-color: var(--primary);">
                  <div>
                    <div style="font-weight: 600; color: var(--text-dark);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                    <div style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø¥Ø¯Ø§Ø±Ø© Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div style="margin-top: 1.5rem; display: flex; justify-content: flex-end; gap: 1rem;">
            <button type="button" class="btn btn-ghost" onclick="closeUserModal()">
              Ø¥Ù„ØºØ§Ø¡
            </button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© -->
  <div id="invoiceModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
        <button class="modal-close" onclick="closeInvoiceModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="invoice-preview">
          <div class="invoice-header">
            <div class="invoice-title">ÙØ§ØªÙˆØ±Ø© ØµØ±Ù ÙˆÙ‚ÙˆØ¯</div>
            <div class="invoice-number" id="invoiceNumber">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</div>
          </div>
          
          <div class="invoice-section">
            <div class="invoice-section-title">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
            <div class="invoice-details">
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ù‚Ø³Ù…</div>
                <div class="invoice-detail-value" id="invoiceBranch">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ù„ÙˆØ­Ø©</div>
                <div class="invoice-detail-value" id="invoicePlate">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
                <div class="invoice-detail-value" id="invoiceDriver">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</div>
                <div class="invoice-detail-value" id="invoiceVehicleType">-</div>
              </div>
            </div>
          </div>
          
          <div class="invoice-section">
            <div class="invoice-section-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµØ±Ù</div>
            <div class="invoice-details">
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</div>
                <div class="invoice-detail-value" id="invoicePrevOdometer">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
                <div class="invoice-detail-value" id="invoiceNewOdometer">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</div>
                <div class="invoice-detail-value" id="invoiceDistance">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ù„ØªØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©</div>
                <div class="invoice-detail-value" id="invoiceLiters">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</div>
                <div class="invoice-detail-value" id="invoicePrice">-</div>
              </div>
            </div>
          </div>
          
          <div class="invoice-section">
            <div class="invoice-section-title">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¬Ø§Ù„ÙˆÙ†Ø§Øª</div>
            <div class="invoice-details">
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ù„ØªØ±Ø§Øª</div>
                <div class="invoice-detail-value" id="invoiceLiters2">-</div>
              </div>
              <div class="invoice-detail-item">
                <div class="invoice-detail-label">Ø§Ù„Ø¬Ø§Ù„ÙˆÙ†Ø§Øª</div>
                <div class="invoice-detail-value" id="invoiceGallons">-</div>
              </div>
            </div>
          </div>
          
          <div class="invoice-total">
            <div class="invoice-total-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
            <div class="invoice-total-value" id="invoiceTotal">0</div>
          </div>
          
          <div class="invoice-actions">
            <button class="btn btn-primary" onclick="printInvoice()">
              <i class="fas fa-print"></i>
              Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            </button>
            <button class="btn btn-success" onclick="saveInvoice()">
              <i class="fas fa-save"></i>
              Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
            </button>
            <button class="btn btn-danger" onclick="closeInvoiceModal()">
              <i class="fas fa-times"></i>
              Ø¥ØºÙ„Ø§Ù‚
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>
  <!-- Ù…ÙƒØªØ¨Ø© jsPDF Ù„Ù„ØªØµØ¯ÙŠØ± PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <script>
    // ---------- Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ----------
    const firebaseConfig = {
      apiKey: "AIzaSyB5nhg3O_H-7QmJDuqaq5nyHa3MjsdgxyY",
      authDomain: "mypro-aa841.firebaseapp.com",
      databaseURL: "https://mypro-aa841-default-rtdb.firebaseio.com",
      projectId: "mypro-aa841",
      storageBucket: "mypro-aa841.firebasestorage.app",
      messagingSenderId: "936452416964",
      appId: "1:936452416964:web:c792e6f63ad328dd217091",
      measurementId: "G-HYYN6TRQXW"
    };
    
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const firestore = firebase.firestore();
    const rtdb = firebase.database();
    
    // ---------- Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ----------
    let currentUser = null;
    let userData = null;
    let currentPlate = null;
    let currentVehicle = null;
    let currentRecordForInvoice = null;
    let currentEditingUserId = null;
    let allUsersCache = [];
    let currentPage = 'dashboard';
    let vehiclesCache = [];
    let logsCache = [];
    let dailyFuelCache = [];
    let currentVehiclesPage = 1;
    let currentLogsPage = 1;
    let currentUsersPage = 1;
    const itemsPerPage = 10;
    let isEditingVehicle = false;
    let isEditingUser = false;
    
    const $ = id => document.getElementById(id);
    const fmt = (n,d=2)=>(isFinite(n)?Number(n).toFixed(d):'');
    const hide = el => el.classList.add('hidden');
    const show = el => el.classList.remove('hidden');
    
    // ========== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ ==========
    function displayDate(dateStr) {
      if (!dateStr) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return 'ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­';
      
      const day = date.getDate().toString().padStart(2, '0');
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const year = date.getFullYear();
      
      return `${day}/${month}/${year}`;
    }
    
    function displayDateTime(dateStr, timeStr) {
      const date = displayDate(dateStr);
      const time = timeStr || '--:--';
      return `${date} ${time}`;
    }
    
    function getMiladiDate(daysOffset = 0) {
      const date = new Date();
      date.setDate(date.getDate() + daysOffset);
      return date.toISOString().slice(0, 10);
    }
    
    function today(){ return getMiladiDate(); }
    function zeroPad(n, len=3){ return String(n).padStart(len,'0'); }
    function getCurrentTime() {
      const now = new Date();
      return now.toLocaleTimeString('en-US', { 
        hour12: false,
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function showAlert(message, type = 'success') {
      const alertsContainer = document.getElementById('alertsContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
      `;
      
      alertsContainer.appendChild(alert);
      
      setTimeout(() => {
        alert.style.opacity = '0';
        alert.style.transform = 'translateX(-20px)';
        setTimeout(() => alert.remove(), 300);
      }, 4000);
    }
    
    // ========== ÙˆØ¸Ø§Ø¦Ù Ù†Ø¸Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© ==========
    
    // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    function checkPermission(permissionName) {
      if (!userData) return false;
      
      // Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ø¯ÙŠÙ‡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
      if (userData.role === 'Ù…Ø¯ÙŠØ±') return true;
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
      const permissions = userData.permissions || {};
      return permissions[permissionName] === true;
    }
    
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ©
    function checkIfCanManageUsers() {
      return checkPermission('manageUsers');
    }
    
    function checkIfCanManageVehicles() {
      return checkPermission('manageVehicles');
    }
    
    function checkIfCanDispenseFuel() {
      return checkPermission('dispenseFuel');
    }
    
    function checkIfCanViewReports() {
      return checkPermission('viewReports');
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
    function updateUIBasedOnRole() {
      const role = userData.role;
      const permissions = userData.permissions || {};
      
      // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
      document.querySelectorAll('[data-permission]').forEach(element => {
        const permission = element.getAttribute('data-permission');
        if (!checkPermission(permission)) {
          element.style.display = 'none';
        }
      });
      
      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø¹ÙŠÙ†Ø©
      document.querySelectorAll('[data-permission]').forEach(button => {
        const permission = button.getAttribute('data-permission');
        if (!checkPermission(permission)) {
          button.style.display = 'none';
        }
      });
    }
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ØµÙØ­Ø§Øª
    function checkPagePermission(page) {
      switch(page) {
        case 'vehicles':
          return checkIfCanManageVehicles();
        case 'fuel':
          return checkIfCanDispenseFuel();
        case 'history':
          return checkIfCanViewReports();
        case 'users':
          return checkIfCanManageUsers();
        default:
          return true;
      }
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙˆØµÙˆÙ„ Ù„ØµÙØ­Ø© Ø¨Ø¯ÙˆÙ† ØµÙ„Ø§Ø­ÙŠØ©
    function showPermissionError(action) {
      const actionMessages = {
        'manageVehicles': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª',
        'dispenseFuel': 'ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯',
        'viewReports': 'Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
        'manageUsers': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'
      };
      
      const message = `Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© ${actionMessages[action] || 'ØªÙ†ÙÙŠØ° Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©'}`;
      showAlert(message, 'error');
    }
    
    // ---------- Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ----------
    document.getElementById('togglePassword').addEventListener('click', function() {
      const passwordInput = document.getElementById('loginPassword');
      const icon = this.querySelector('i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
      }
    });
    
    // ---------- Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ----------
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;
      const loginError = document.getElementById('loginError');
      
      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        currentUser = userCredential.user;
        
        const userDoc = await firestore.collection('users').doc(currentUser.uid).get();
        
        if (userDoc.exists) {
          userData = userDoc.data();
          
          if (!userData || Object.keys(userData).length === 0) {
            showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
            await auth.signOut();
            return;
          }
          
          if (userData.status === 'suspended') {
            showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚ÙˆÙØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
            await auth.signOut();
            return;
          }
          
          if (userData.expiryDate && new Date(userData.expiryDate) < new Date()) {
            showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
            await auth.signOut();
            return;
          }
          
          if (!userData.name || userData.name.trim() === '') {
            userData.name = currentUser.email.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…';
          }
          
          if (!userData.role) {
            userData.role = 'Ù…Ø³ØªØ®Ø¯Ù…';
          }
          
          if (!userData.branch) {
            userData.branch = 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…';
          }
          
          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
          if (!userData.permissions) {
            userData.permissions = {
              manageVehicles: userData.role === 'Ù…Ø¯ÙŠØ±' || userData.role === 'Ù…Ø´Ø±Ù',
              dispenseFuel: true,
              viewReports: true,
              manageUsers: userData.role === 'Ù…Ø¯ÙŠØ±'
            };
          }
          
          userData.name = userData.name.trim();
          
          updateUIForUser();
          
          hide(document.getElementById('loginContainer'));
          show(document.getElementById('mainContent'));
          
          navigateTo('dashboard');
          
          showAlert(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ${userData.name} ÙÙŠ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯`, 'success');
          
        } else {
          userData = {
            name: currentUser.email.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…',
            role: 'Ù…Ø³ØªØ®Ø¯Ù…',
            branch: 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…',
            email: currentUser.email,
            status: 'active',
            permissions: {
              manageVehicles: false,
              dispenseFuel: true,
              viewReports: true,
              manageUsers: false
            }
          };
          
          await firestore.collection('users').doc(currentUser.uid).set(userData);
          
          updateUIForUser();
          
          hide(document.getElementById('loginContainer'));
          show(document.getElementById('mainContent'));
          
          navigateTo('dashboard');
          
          showAlert('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }
        
      } catch (error) {
        console.error('Login error:', error);
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        loginError.style.display = 'none';
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ù†ÙˆØ§Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        let errorMessage = '';
        
        switch (error.code) {
          case 'auth/user-not-found':
            errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…';
            break;
          case 'auth/wrong-password':
            errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
            break;
          case 'auth/user-disabled':
            errorMessage = 'Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¹Ø·Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±';
            break;
          case 'auth/too-many-requests':
            errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
            break;
          case 'auth/invalid-email':
            errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
            break;
          case 'auth/network-request-failed':
            errorMessage = 'Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
            break;
          default:
            errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        loginError.innerHTML = `
          <i class="fas fa-exclamation-circle"></i>
          <span>${errorMessage}</span>
        `;
        loginError.style.display = 'flex';
        
        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø£ÙŠØ¶Ø§Ù‹
        showAlert(errorMessage, 'error');
      }
    });
    
    function updateUIForUser() {
      // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø³Ø§ÙŠØ¯Ø¨Ø§Ø±
      const userAvatar = document.getElementById('userAvatarSidebar');
      if (userData.name) {
        userAvatar.textContent = userData.name.charAt(0);
      }
      
      document.getElementById('userNameSidebar').textContent = userData.name || currentUser.email;
      
      const roleDisplay = userData.role === 'Ù…Ø³ØªØ®Ø¯Ù…' ? 'Ø¶Ø§Ø¨Ø· Ø­Ø±ÙƒØ© ÙˆØªØ´ØºÙŠÙ„' : userData.role;
      document.getElementById('userRoleSidebar').textContent = roleDisplay || 'Ø¶Ø§Ø¨Ø· Ø­Ø±ÙƒØ© ÙˆØªØ´ØºÙŠÙ„';
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
      updateUIBasedOnRole();
    }
    
    // ---------- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ----------
    document.getElementById('logoutBtnSidebar').addEventListener('click', () => {
      auth.signOut().then(() => {
        currentUser = null;
        userData = null;
        
        show(document.getElementById('loginContainer'));
        hide(document.getElementById('mainContent'));
        
        document.getElementById('loginForm').reset();
        document.getElementById('loginError').style.display = 'none';
        
        showAlert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
      });
    });
    
    // ---------- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ----------
    auth.onAuthStateChanged(async (user) => {
      if (user) {
        currentUser = user;
        
        const userDoc = await firestore.collection('users').doc(user.uid).get();
        
        if (userDoc.exists) {
          userData = userDoc.data();
          
          if (!userData || Object.keys(userData).length === 0) {
            await auth.signOut();
            return;
          }
          
          if (userData.status === 'suspended') {
            showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆÙ‚ÙˆÙØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
            await auth.signOut();
            return;
          }
          
          if (userData.expiryDate && new Date(userData.expiryDate) < new Date()) {
            showAlert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
            await auth.signOut();
            return;
          }
          
          if (!userData.name || userData.name.trim() === '') {
            userData.name = currentUser.email.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…';
          }
          
          if (!userData.role) {
            userData.role = 'Ù…Ø³ØªØ®Ø¯Ù…';
          }
          
          if (!userData.branch) {
            userData.branch = 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…';
          }
          
          // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
          if (!userData.permissions) {
            userData.permissions = {
              manageVehicles: userData.role === 'Ù…Ø¯ÙŠØ±' || userData.role === 'Ù…Ø´Ø±Ù',
              dispenseFuel: true,
              viewReports: true,
              manageUsers: userData.role === 'Ù…Ø¯ÙŠØ±'
            };
          }
          
          userData.name = userData.name.trim();
          
          updateUIForUser();
          
          hide(document.getElementById('loginContainer'));
          show(document.getElementById('mainContent'));
          
          navigateTo('dashboard');
        } else {
          userData = {
            name: currentUser.email.split('@')[0] || 'Ù…Ø³ØªØ®Ø¯Ù…',
            role: 'Ù…Ø³ØªØ®Ø¯Ù…',
            branch: 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…',
            email: currentUser.email,
            status: 'active',
            permissions: {
              manageVehicles: false,
              dispenseFuel: true,
              viewReports: true,
              manageUsers: false
            }
          };
          
          await firestore.collection('users').doc(currentUser.uid).set(userData);
          
          updateUIForUser();
          
          hide(document.getElementById('loginContainer'));
          show(document.getElementById('mainContent'));
          
          navigateTo('dashboard');
        }
      } else {
        currentUser = null;
        userData = null;
        
        show(document.getElementById('loginContainer'));
        hide(document.getElementById('mainContent'));
      }
    });
    
    // ---------- Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª Ù…Ø¹ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª ----------
    function navigateTo(page) {
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„
      if (!checkPagePermission(page)) {
        showPermissionError(page);
        return;
      }
      
      // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª
      document.querySelectorAll('.page-content').forEach(el => hide(el));
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø· Ù…Ù† Ø¬Ù…ÙŠØ¹ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
      $(`${page}Page`).classList.remove('hidden');
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø´Ø· Ù„Ø¹Ù†ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      const navItem = document.querySelector(`.nav-item[data-page="${page}"]`);
      if (navItem) {
        navItem.classList.add('active');
      }
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      currentPage = page;
      
      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
      if (window.innerWidth <= 992) {
        $('sidebar').classList.remove('active');
      }
      
      // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙØ­Ø©
      switch(page) {
        case 'dashboard':
          loadDashboardData();
          break;
        case 'vehicles':
          loadVehiclesList();
          break;
        case 'fuel':
          setupFuelPage();
          break;
        case 'history':
          loadLogs();
          break;
        case 'users':
          loadUsersList();
          break;
      }
    }
    
    // ---------- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ­Ø±ÙƒØ© Ù„Ù„Ø¬ÙˆØ§Ù„ ----------
    document.getElementById('mobileMenuToggle').addEventListener('click', () => {
      $('sidebar').classList.toggle('active');
    });
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§ (Ù„Ù„Ø¬ÙˆØ§Ù„)
    document.addEventListener('click', (e) => {
      if (window.innerWidth <= 992) {
        const sidebar = $('sidebar');
        const toggleBtn = $('mobileMenuToggle');
        
        if (sidebar.classList.contains('active') && 
            !sidebar.contains(e.target) && 
            !toggleBtn.contains(e.target)) {
          sidebar.classList.remove('active');
        }
      }
    });
    
    // ---------- Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙ†Ù‚Ù„ ----------
    document.addEventListener('DOMContentLoaded', () => {
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ø¨Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
      const todayDate = getMiladiDate();
      const lastWeekDate = getMiladiDate(-7);
      const firstDayOfMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString().slice(0, 10);
      
      if ($('f_date')) $('f_date').value = todayDate;
      if ($('filterDateFrom')) $('filterDateFrom').value = todayDate; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ÙŠÙˆÙ…
      if ($('filterDateTo')) $('filterDateTo').value = todayDate; // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„ÙŠÙˆÙ…
      if ($('v_registration_date')) $('v_registration_date').value = todayDate;
      if ($('userExpiryDate')) {
        const expiryDate = new Date();
        expiryDate.setFullYear(expiryDate.getFullYear() + 1);
        $('userExpiryDate').value = expiryDate.toISOString().slice(0, 10);
      }
      if ($('dailyFuelDateFilter')) $('dailyFuelDateFilter').value = todayDate;
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù†Ù‚Ø± Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const page = item.getAttribute('data-page');
          navigateTo(page);
        });
      });
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø¯Ø« Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      if ($('userForm')) {
        $('userForm').addEventListener('submit', saveUser);
      }
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
      document.querySelectorAll('.filter-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          filterVehicles(chip.getAttribute('data-filter'));
        });
      });
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
      if ($('searchVehicleInput')) {
        $('searchVehicleInput').addEventListener('input', (e) => {
          searchVehicles(e.target.value);
        });
      }
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø³Ø±ÙŠØ¹ ÙÙŠ ØµÙØ­Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯
      if ($('quickVehicleSearch')) {
        $('quickVehicleSearch').addEventListener('input', (e) => {
          quickSearchVehicle(e.target.value);
        });
      }
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      if ($('searchUsers')) {
        $('searchUsers').addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          searchUsers(query);
        });
      }
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
      document.querySelectorAll('.filter-chip[data-filter]').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
          chip.classList.add('active');
          filterUsers(chip.getAttribute('data-filter'));
        });
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„Ø§ØªØ± ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      if ($('btnFilterLogs')) {
        $('btnFilterLogs').addEventListener('click', loadLogs);
      }
      
      if ($('btnExport')) {
        $('btnExport').addEventListener('click', exportHistoryToExcel);
      }
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙŠ ØªØªØ·Ù„Ø¨ ØµÙ„Ø§Ø­ÙŠØ§Øª
      document.querySelectorAll('[data-permission]').forEach(button => {
        button.addEventListener('click', (e) => {
          const permission = button.getAttribute('data-permission');
          if (!checkPermission(permission)) {
            e.preventDefault();
            e.stopPropagation();
            showPermissionError(permission);
          }
        });
      });
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± ØµÙØ­Ø© ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯ - ÙÙ‚Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ©
      setupFuelPageButtons();
    });
    
    // ========== ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ==========
    async function loadDashboardData() {
      try {
        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª
        const vehiclesSnapshot = await firestore.collection('vehicles').get();
        const vehiclesCount = vehiclesSnapshot.size;
        $('dashboardVehiclesCount').textContent = vehiclesCount;
        $('vehiclesCount').textContent = vehiclesCount;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…
        const todayDate = today();
        const todaySnapshot = await firestore.collection('fuelRecords')
          .where('date', '==', todayDate)
          .get();
        
        let totalLitersToday = 0;
        let totalCostToday = 0;
        
        todaySnapshot.forEach(doc => {
          const record = doc.data();
          totalLitersToday += parseFloat(record.liters) || 0;
          totalCostToday += parseFloat(record.totalCost) || 0;
        });
        
        $('dashboardFuelToday').textContent = fmt(totalLitersToday, 1);
        $('dashboardCostToday').textContent = fmt(totalCostToday, 2);
        
        // ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
        const logsSnapshot = await firestore.collection('fuelRecords').get();
        $('logsCount').textContent = logsSnapshot.size;
        
        // Ø­Ø³Ø§Ø¨ ÙƒÙØ§Ø¡Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (Ù…Ø«Ø§Ù„)
        const efficiency = 85 + Math.floor(Math.random() * 15);
        $('dashboardEfficiency').textContent = `${efficiency}%`;
        
      } catch (error) {
        console.error('Error loading dashboard data:', error);
      }
    }
    
    function refreshDashboard() {
      loadDashboardData();
      showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'success');
    }
    
    function printDailyReport() {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      showAlert('Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…...', 'info');
    }
    
    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª ==========
    async function loadVehiclesList() {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      
      const tbody = $('listVehicles');
      tbody.innerHTML = '<tr id="loadingVehiclesRow"><td colspan="11"><div class="loader"><div class="spinner"></div><div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª...</div></td></tr>';
      
      try {
        const snapshot = await firestore.collection('vehicles').get();
        vehiclesCache = [];
        
        snapshot.forEach((doc, index) => {
          const vehicle = doc.data();
          vehiclesCache.push({
            id: doc.id,
            index: index + 1,
            ...vehicle
          });
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        updateVehiclesStats();
        
        renderVehiclesTable(vehiclesCache);
        
      } catch (error) {
        console.error('Error loading vehicles:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª', 'error');
      }
    }
    
    function updateVehiclesStats() {
      const totalVehicles = vehiclesCache.length;
      const activeVehicles = vehiclesCache.filter(v => v.status === 'Ù†Ø´Ø·').length;
      const uniqueDrivers = [...new Set(vehiclesCache.map(v => v.driver))].length;
      const uniqueBranches = [...new Set(vehiclesCache.map(v => v.branch))].length;
      
      $('totalVehicles').textContent = totalVehicles;
      $('activeVehicles').textContent = activeVehicles;
      $('totalDrivers').textContent = uniqueDrivers;
      $('totalBranches').textContent = uniqueBranches;
    }
    
    function renderVehiclesTable(vehicles) {
      const tbody = $('listVehicles');
      
      if (vehicles.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="11" style="text-align: center; padding: 2rem; color: var(--text-gray);">
              <div class="empty-state-icon">
                <i class="fas fa-car"></i>
              </div>
              <div class="empty-state-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±ÙƒØ¨Ø§Øª Ù…Ø³Ø¬Ù„Ø©</div>
              <div class="empty-state-description">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø±ÙƒØ¨Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = '';
      
      vehicles.forEach(vehicle => {
        let typeBadgeClass = 'type-petrol';
        let typeIcon = 'fa-gas-pump';
        if (vehicle.vehicleType === 'Ø¬Ø§Ø²') {
          typeBadgeClass = 'type-diesel';
          typeIcon = 'fa-oil-can';
        } else if (vehicle.vehicleType === 'Ù…ÙˆÙ„Ø¯') {
          typeBadgeClass = 'type-generator';
          typeIcon = 'fa-bolt';
        }
        
        let statusClass = 'badge-success';
        let statusIcon = 'fa-check-circle';
        let statusText = 'Ù†Ø´Ø·';
        
        if (vehicle.status === 'ØºÙŠØ± Ù†Ø´Ø·') {
          statusClass = 'badge-danger';
          statusIcon = 'fa-pause-circle';
          statusText = 'ØºÙŠØ± Ù†Ø´Ø·';
        } else if (vehicle.status === 'ØµÙŠØ§Ù†Ø©') {
          statusClass = 'badge-warning';
          statusIcon = 'fa-tools';
          statusText = 'ØµÙŠØ§Ù†Ø©';
        } else if (vehicle.status === 'Ù…Ø³ØªØ£Ø¬Ø±') {
          statusClass = 'badge-info';
          statusIcon = 'fa-handshake';
          statusText = 'Ù…Ø³ØªØ£Ø¬Ø±';
        }
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><span class="badge badge-primary">${vehicle.index}</span></td>
          <td><span style="font-weight: 700; color: var(--text-dark);">${vehicle.plate}</span></td>
          <td><span style="font-weight: 600; color: var(--text-dark);">${vehicle.driver}</span></td>
          <td style="font-size: var(--text-sm);">${vehicle.phone || '-'}</td>
          <td><span class="badge badge-info" style="font-size: var(--text-xs);">${vehicle.branch || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span></td>
          <td>
            <span class="vehicle-type ${typeBadgeClass}" style="font-size: var(--text-xs;">
              <i class="fas ${typeIcon}"></i> ${vehicle.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†'}
            </span>
          </td>
          <td><span style="font-weight: 700; color: var(--primary);">${vehicle.lastOdometer || vehicle.initialOdometer || 0}</span></td>
          <td><span style="font-weight: 700; color: var(--success);">${fmt(vehicle.kpl || 0, 2)}</span></td>
          <td>
            <span class="badge ${statusClass}" style="font-size: var(--text-xs);">
              <i class="fas ${statusIcon}"></i> ${statusText}
            </span>
          </td>
          <td style="font-size: var(--text-sm);">${displayDate(vehicle.createdAt)}</td>
          <td>
            <div style="display: flex; gap: 0.25rem;">
              <button class="btn btn-sm btn-primary edit-vehicle-btn" 
                      data-plate="${vehicle.plate}"
                      style="padding: 0.25rem 0.5rem; font-size: var(--text-xs);"
                      title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger delete-vehicle-btn" 
                      data-plate="${vehicle.plate}"
                      data-driver="${vehicle.driver}"
                      style="padding: 0.25rem 0.5rem; font-size: var(--text-xs);"
                      title="Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø©">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
      setTimeout(() => {
        document.querySelectorAll('.edit-vehicle-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const plate = e.currentTarget.getAttribute('data-plate');
            editVehicle(plate);
          });
        });
        
        document.querySelectorAll('.delete-vehicle-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const plate = e.currentTarget.getAttribute('data-plate');
            const driver = e.currentTarget.getAttribute('data-driver');
            deleteVehicle(plate, driver);
          });
        });
      }, 100);
    }
    
    function filterVehicles(filter) {
      let filtered = vehiclesCache;
      
      if (filter !== 'all') {
        if (['Ø¨Ù†Ø²ÙŠÙ†', 'Ø¬Ø§Ø²', 'Ù…ÙˆÙ„Ø¯'].includes(filter)) {
          filtered = vehiclesCache.filter(v => v.vehicleType === filter);
        } else if (['Ù†Ø´Ø·', 'ØºÙŠØ± Ù†Ø´Ø·', 'ØµÙŠØ§Ù†Ø©', 'Ù…Ø³ØªØ£Ø¬Ø±'].includes(filter)) {
          filtered = vehiclesCache.filter(v => v.status === filter);
        }
      }
      
      renderVehiclesTable(filtered);
    }
    
    function searchVehicles(query) {
      if (!query) {
        renderVehiclesTable(vehiclesCache);
        return;
      }
      
      const filtered = vehiclesCache.filter(v => 
        v.plate.toLowerCase().includes(query.toLowerCase()) || 
        v.driver.toLowerCase().includes(query.toLowerCase()) ||
        v.branch.toLowerCase().includes(query.toLowerCase()) ||
        (v.phone && v.phone.includes(query))
      );
      
      renderVehiclesTable(filtered);
    }
    
    async function editVehicle(plate) {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      
      try {
        const vehicleDoc = await firestore.collection('vehicles').doc(plate).get();
        
        if (vehicleDoc.exists) {
          const vehicle = vehicleDoc.data();
          
          $('v_plate').value = plate;
          $('v_driver').value = vehicle.driver || '';
          $('v_phone').value = vehicle.phone || '';
          $('v_init_odo').value = vehicle.lastOdometer || vehicle.initialOdometer || '';
          $('v_kpl').value = vehicle.kpl || '';
          $('v_type').value = vehicle.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†';
          $('v_branch').value = vehicle.branch || 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…';
          $('v_status').value = vehicle.status || 'Ù†Ø´Ø·';
          $('v_registration_date').value = vehicle.registrationDate || '';
          $('v_notes').value = vehicle.notes || '';
          
          // Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ¥Ù„ØºØ§Ø¡
          $('btnSaveVehicle').style.display = 'none';
          $('btnUpdateVehicle').style.display = 'inline-flex';
          $('btnClearVehicleForm').style.display = 'inline-flex';
          $('btnCancelEdit').style.display = 'none';
          
          isEditingVehicle = true;
          
          showAlert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ${plate}`, 'success');
        }
      } catch (error) {
        console.error('Error loading vehicle:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
      }
    }
    
    async function deleteVehicle(plate, driver) {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø© "${plate}" Ù„Ù„Ø³Ø§Ø¦Ù‚ "${driver}"ØŸ`)) {
        return;
      }
      
      try {
        await firestore.collection('vehicles').doc(plate).delete();
        showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadVehiclesList();
      } catch (error) {
        console.error('Error deleting vehicle:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
      }
    }
    
    // Ø²Ø± Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
    if ($('btnSaveVehicle')) {
      $('btnSaveVehicle').addEventListener('click', async () => {
        if (!checkIfCanManageVehicles()) {
          showPermissionError('manageVehicles');
          return;
        }
        
        const plate = $('v_plate').value.trim();
        const driver = $('v_driver').value.trim();
        const phone = $('v_phone').value.trim();
        const initOdo = parseInt($('v_init_odo').value);
        const kpl = parseFloat($('v_kpl').value);
        const vehicleType = $('v_type').value;
        const branch = $('v_branch').value;
        const status = $('v_status').value;
        const registrationDate = $('v_registration_date').value;
        const notes = $('v_notes').value.trim();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
        let hasError = false;
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
        document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
        document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
        
        if (!plate) {
          $('v_plate_error').classList.add('show');
          $('v_plate').classList.add('error');
          hasError = true;
        }
        
        if (!driver) {
          $('v_driver_error').classList.add('show');
          $('v_driver').classList.add('error');
          hasError = true;
        }
        
        if (!(initOdo >= 0)) {
          $('v_init_odo_error').classList.add('show');
          $('v_init_odo').classList.add('error');
          hasError = true;
        }
        
        if (!(kpl > 0)) {
          $('v_kpl_error').classList.add('show');
          $('v_kpl').classList.add('error');
          hasError = true;
        }
        
        if (!vehicleType) {
          $('v_type_error').classList.add('show');
          $('v_type').classList.add('error');
          hasError = true;
        }
        
        if (!branch) {
          $('v_branch_error').classList.add('show');
          $('v_branch').classList.add('error');
          hasError = true;
        }
        
        if (hasError) {
          showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
          return;
        }
        
        const vehicleData = {
          plate: plate,
          driver: driver,
          phone: phone,
          initialOdometer: initOdo,
          lastOdometer: initOdo,
          kpl: kpl,
          vehicleType: vehicleType,
          branch: branch,
          status: status,
          registrationDate: registrationDate,
          notes: notes,
          createdBy: currentUser.uid,
          createdByName: userData.name || currentUser.email,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        try {
          await firestore.collection('vehicles').doc(plate).set(vehicleData);
          
          showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
          
          // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚ÙˆÙ„
          clearVehicleForm();
          
          loadVehiclesList();
          
        } catch (error) {
          console.error('Error saving vehicle:', error);
          
          // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø¯Ø¯Ø©
          let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©';
          
          if (error.code === 'permission-denied') {
            errorMessage = 'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙƒØ¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©';
          } else if (error.code === 'already-exists') {
            errorMessage = 'Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ù…Ø³Ø¬Ù„Ø© Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…';
          } else if (error.code === 'not-found') {
            errorMessage = 'Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
          }
          
          showAlert(errorMessage, 'error');
        }
      });
    }
    
    // Ø²Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
    if ($('btnUpdateVehicle')) {
      $('btnUpdateVehicle').addEventListener('click', async () => {
        if (!checkIfCanManageVehicles()) {
          showPermissionError('manageVehicles');
          return;
        }
        
        const plate = $('v_plate').value.trim();
        const driver = $('v_driver').value.trim();
        const phone = $('v_phone').value.trim();
        const initOdo = parseInt($('v_init_odo').value);
        const kpl = parseFloat($('v_kpl').value);
        const vehicleType = $('v_type').value;
        const branch = $('v_branch').value;
        const status = $('v_status').value;
        const registrationDate = $('v_registration_date').value;
        const notes = $('v_notes').value.trim();
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
        let hasError = false;
        
        // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
        document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
        document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
        
        if (!plate) {
          $('v_plate_error').classList.add('show');
          $('v_plate').classList.add('error');
          hasError = true;
        }
        
        if (!driver) {
          $('v_driver_error').classList.add('show');
          $('v_driver').classList.add('error');
          hasError = true;
        }
        
        if (!(initOdo >= 0)) {
          $('v_init_odo_error').classList.add('show');
          $('v_init_odo').classList.add('error');
          hasError = true;
        }
        
        if (!(kpl > 0)) {
          $('v_kpl_error').classList.add('show');
          $('v_kpl').classList.add('error');
          hasError = true;
        }
        
        if (!vehicleType) {
          $('v_type_error').classList.add('show');
          $('v_type').classList.add('error');
          hasError = true;
        }
        
        if (!branch) {
          $('v_branch_error').classList.add('show');
          $('v_branch').classList.add('error');
          hasError = true;
        }
        
        if (hasError) {
          showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
          return;
        }
        
        const vehicleData = {
          plate: plate,
          driver: driver,
          phone: phone,
          initialOdometer: initOdo,
          lastOdometer: initOdo,
          kpl: kpl,
          vehicleType: vehicleType,
          branch: branch,
          status: status,
          registrationDate: registrationDate,
          notes: notes,
          updatedBy: currentUser.uid,
          updatedByName: userData.name || currentUser.email,
          updatedAt: new Date().toISOString()
        };
        
        try {
          await firestore.collection('vehicles').doc(plate).update(vehicleData);
          
          showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
          
          // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
          $('btnSaveVehicle').style.display = 'inline-flex';
          $('btnUpdateVehicle').style.display = 'none';
          $('btnClearVehicleForm').style.display = 'inline-flex';
          $('btnCancelEdit').style.display = 'none';
          
          clearVehicleForm();
          isEditingVehicle = false;
          
          loadVehiclesList();
          
        } catch (error) {
          console.error('Error updating vehicle:', error);
          showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
        }
      });
    }
    
    // Ø²Ø± Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    if ($('btnClearVehicleForm')) {
      $('btnClearVehicleForm').addEventListener('click', () => {
        if (!checkIfCanManageVehicles()) {
          showPermissionError('manageVehicles');
          return;
        }
        clearVehicleForm();
      });
    }
    
    // Ø²Ø± Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    if ($('btnCancelEdit')) {
      $('btnCancelEdit').addEventListener('click', () => {
        if (!checkIfCanManageVehicles()) {
          showPermissionError('manageVehicles');
          return;
        }
        clearVehicleForm();
        $('btnSaveVehicle').style.display = 'inline-flex';
        $('btnUpdateVehicle').style.display = 'none';
        $('btnClearVehicleForm').style.display = 'inline-flex';
        $('btnCancelEdit').style.display = 'none';
        isEditingVehicle = false;
      });
    }
    
    // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    function clearVehicleForm() {
      $('v_plate').value = '';
      $('v_driver').value = '';
      $('v_phone').value = '';
      $('v_init_odo').value = '';
      $('v_kpl').value = '';
      $('v_type').value = '';
      $('v_branch').value = '';
      $('v_status').value = 'Ù†Ø´Ø·';
      $('v_registration_date').value = '';
      $('v_notes').value = '';
      
      // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
      document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
      document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
      
      // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      if (!isEditingVehicle) {
        $('btnSaveVehicle').style.display = 'inline-flex';
        $('btnUpdateVehicle').style.display = 'none';
        $('btnClearVehicleForm').style.display = 'inline-flex';
        $('btnCancelEdit').style.display = 'none';
      }
    }
    
    function exportVehicles() {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      showAlert('Ø¬Ø§Ø±ÙŠ ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª...', 'info');
    }
    
    function printVehicles() {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©...', 'info');
    }
    
    function importVehicles() {
      if (!checkIfCanManageVehicles()) {
        showPermissionError('manageVehicles');
        return;
      }
      showAlert('ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
    }
    
    function changeVehiclesPage(direction) {
      showAlert('ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
    }
    
    // ========== ÙˆØ¸Ø§Ø¦Ù ØµÙØ­Ø© ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯ - Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© Ø¨Ø¯ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ==========
    function setupFuelPage() {
      if (!checkIfCanDispenseFuel()) {
        showPermissionError('dispenseFuel');
        return;
      }
      
      // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
      if ($('f_date')) $('f_date').value = today();
      if ($('f_time')) $('f_time').value = getCurrentTime();
      
      // ØªØ­Ù…ÙŠÙ„ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
      loadTodayFuelStats();
      
      // ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
      loadFuelDailyTable();
      
      // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
      if ($('f_curr')) {
        $('f_curr').addEventListener('input', recalc);
      }
      
      if ($('f_price')) {
        $('f_price').addEventListener('input', recalc);
      }
      
      // Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
      if ($('btnLoadVehicle')) {
        $('btnLoadVehicle').addEventListener('click', loadVehicleForFuel);
      }
    }
    
    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± ØµÙØ­Ø© ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯ - ÙÙ‚Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³ÙÙ„ÙŠØ©
    function setupFuelPageButtons() {
      // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„ Ø¨Ø§Ù„ÙˆØ¸Ø§Ø¦Ù
      const bottomButtons = [
        { id: 'saveFuelBtnBottom', func: saveFuelRecord },
        { id: 'previewInvoiceBtnBottom', func: previewInvoiceModal },
        { id: 'clearFuelBtnBottom', func: clearFuelForm }
      ];
      
      // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ù„Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø£Ø³ÙÙ„
      bottomButtons.forEach(button => {
        const btn = $(button.id);
        if (btn) {
          btn.addEventListener('click', () => {
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù‚Ø¨Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„ÙˆØ¸ÙŠÙØ©
            if (!checkIfCanDispenseFuel()) {
              showPermissionError('dispenseFuel');
              return;
            }
            button.func();
          });
        }
      });
    }
    
    async function loadTodayFuelStats() {
      try {
        const todayDate = today();
        const todaySnapshot = await firestore.collection('fuelRecords')
          .where('date', '==', todayDate)
          .get();
        
        let totalLiters = 0;
        let totalCost = 0;
        let uniqueVehicles = new Set();
        
        todaySnapshot.forEach(doc => {
          const record = doc.data();
          totalLiters += parseFloat(record.liters) || 0;
          totalCost += parseFloat(record.totalCost) || 0;
          uniqueVehicles.add(record.plate);
        });
        
        $('todayFuelCount').textContent = todaySnapshot.size;
        $('todayFuelLiters').textContent = fmt(totalLiters, 1);
        $('todayFuelCost').textContent = fmt(totalCost, 2);
        $('activeFuelVehicles').textContent = uniqueVehicles.size;
        
      } catch (error) {
        console.error('Error loading today fuel stats:', error);
      }
    }
    
    async function quickSearchVehicle(query) {
      if (!query) {
        $('quickSearchResults').style.display = 'none';
        return;
      }
      
      try {
        const snapshot = await firestore.collection('vehicles')
          .where('plate', '>=', query)
          .where('plate', '<=', query + '\uf8ff')
          .limit(5)
          .get();
        
        if (snapshot.empty) {
          $('quickSearchResults').innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-gray);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
        } else {
          let resultsHTML = '<div style="display: grid; gap: 0.5rem;">';
          snapshot.forEach(doc => {
            const vehicle = doc.data();
            resultsHTML += `
              <div class="fuel-record-card clickable" onclick="selectQuickVehicle('${vehicle.plate}')">
                <div class="fuel-record-header">
                  <div class="fuel-record-title">${vehicle.plate}</div>
                  <div class="fuel-record-id">${vehicle.driver}</div>
                </div>
                <div class="fuel-record-details">
                  <div class="fuel-record-item">
                    <span class="fuel-record-label">Ø§Ù„Ù‚Ø³Ù…:</span>
                    <span class="fuel-record-value">${vehicle.branch}</span>
                  </div>
                  <div class="fuel-record-item">
                    <span class="fuel-record-label">Ø§Ù„Ù†ÙˆØ¹:</span>
                    <span class="fuel-record-value">${vehicle.vehicleType}</span>
                  </div>
                </div>
              </div>
            `;
          });
          resultsHTML += '</div>';
          $('quickSearchResults').innerHTML = resultsHTML;
        }
        
        $('quickSearchResults').style.display = 'block';
        
      } catch (error) {
        console.error('Error in quick search:', error);
      }
    }
    
    function selectQuickVehicle(plate) {
      $('f_plate').value = plate;
      $('quickSearchResults').style.display = 'none';
      loadVehicleForFuel();
    }
    
    async function loadVehicleForFuel() {
      if (!checkIfCanDispenseFuel()) {
        showPermissionError('dispenseFuel');
        return;
      }
      
      const plate = $('f_plate').value.trim();
      if (!plate) { 
        showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
        hide($('sectionLoaded'));
        return; 
      }
      
      try {
        const vehicleDoc = await firestore.collection('vehicles').doc(plate).get();
        
        if (!vehicleDoc.exists) { 
          showAlert('Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…', 'error');
          hide($('sectionLoaded'));
          return; 
        }
        
        const vehicleData = vehicleDoc.data();
        
        currentPlate = plate;
        currentVehicle = vehicleData;
        show($('sectionLoaded'));
        
        $('f_driver').value = currentVehicle.driver || '';
        
        const vehicleType = currentVehicle.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†';
        $('f_type_text').textContent = vehicleType;
        
        let badgeClass = 'type-petrol';
        let badgeIcon = 'fa-gas-pump';
        
        if (vehicleType === 'Ø¬Ø§Ø²') {
          badgeClass = 'type-diesel';
          badgeIcon = 'fa-oil-can';
        } else if (vehicleType === 'Ù…ÙˆÙ„Ø¯') {
          badgeClass = 'type-generator';
          badgeIcon = 'fa-bolt';
        }
        
        $('f_type_badge').className = `vehicle-type ${badgeClass}`;
        $('f_type_badge').innerHTML = `<i class="fas ${badgeIcon}"></i> ${vehicleType}`;
        
        $('f_prev').value = currentVehicle.lastOdometer ?? '';
        $('f_kpl').value = currentVehicle.kpl ?? '';
        $('f_date').value = today();
        $('f_time').value = getCurrentTime();
        
        ['f_curr','f_distance','f_liters','f_gallons','f_price','f_cost','f_notes'].forEach(id => {
          if ($(id)) $(id).value = '';
        });
        
        showAlert(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ${plate}`, 'success');
        
      } catch (error) {
        console.error('Error loading vehicle:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'error');
      }
    }
    
    function recalc() {
      const prev = parseFloat($('f_prev').value);
      const curr = parseFloat($('f_curr').value);
      const kpl  = parseFloat($('f_kpl').value);
      const price = parseFloat($('f_price').value);

      const distance = (isFinite(curr) && isFinite(prev) && curr > prev) ? (curr - prev) : 0;
      if ($('f_distance')) $('f_distance').value = distance ? fmt(distance,1) : '';

      const liters = (distance > 0 && isFinite(kpl) && kpl > 0) ? (distance / kpl) : 0;
      const gallons = liters > 0 ? (liters / 4.546) : 0;
      
      if (liters > 0 && $('f_liters')) {
        $('f_liters').value = `${fmt(liters,2)} Ù„ØªØ±`;
      } else if ($('f_liters')) {
        $('f_liters').value = '';
      }

      if (gallons > 0 && $('f_gallons')) {
        $('f_gallons').value = `${fmt(gallons,2)} Ø¬Ø§Ù„ÙˆÙ†`;
      } else if ($('f_gallons')) {
        $('f_gallons').value = '';
      }

      const cost = (liters > 0 && price > 0) ? (liters * price) : 0;
      if ($('f_cost')) $('f_cost').value = cost ? fmt(cost,2) : '';
    }
    
    async function saveFuelRecord() {
      if (!checkIfCanDispenseFuel()) {
        showPermissionError('dispenseFuel');
        return;
      }
      
      if (!currentPlate || !currentVehicle) { 
        showAlert('ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹', 'error');
        return; 
      }
      
      const prev = Number($('f_prev').value);
      const curr = Number($('f_curr').value);
      const kpl  = Number($('f_kpl').value);
      const price = Number($('f_price').value);
      const dist = Number($('f_distance').value);
      const liters = parseFloat($('f_liters').value) || 0;
      const cost = Number($('f_cost').value);
      const date = $('f_date').value || today();
      const time = $('f_time').value || getCurrentTime();
      const notes = $('f_notes').value.trim();
      const vehicleType = currentVehicle.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†';

      if (!(curr > prev)) { 
        showAlert('Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚', 'error');
        return; 
      }
      
      if (!(kpl > 0)) { 
        showAlert('Ù…Ø¹Ø¯Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
        return; 
      }
      
      if (!(price > 0)) { 
        showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±', 'error');
        return; 
      }
      
      if (!(dist > 0) || !(liters > 0)) { 
        showAlert('Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
        return; 
      }
      
      const opNum = await generateOperationNumber();
      const opId = `Adiyat-Op${zeroPad(opNum, 3)}`;
      
      const gallons = (liters / 4.546).toFixed(2);
      
      const record = {
        date: date,
        time: time,
        plate: currentPlate,
        driver: currentVehicle.driver || '',
        vehicleType: vehicleType,
        prevOdometer: prev,
        newOdometer: curr,
        distance: dist,
        kpl: kpl,
        liters: liters,
        gallons: gallons,
        pricePerLiter: price,
        totalCost: cost,
        notes: notes,
        opId: opId,
        branch: userData.branch || 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…',
        userId: currentUser.uid,
        userName: userData.name || currentUser.email,
        createdAt: new Date().toISOString()
      };
      
      // ØªØ­Ø³ÙŠÙ† Ø³Ø±Ø¹Ø© Ø§Ù„Ø­ÙØ¸ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… batch write
      const batch = firestore.batch();
      
      try {
        // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø§Ù„ÙˆÙ‚ÙˆØ¯
        const fuelRecordRef = firestore.collection('fuelRecords').doc();
        batch.set(fuelRecordRef, record);
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
        const vehicleRef = firestore.collection('vehicles').doc(currentPlate);
        batch.update(vehicleRef, {
          lastOdometer: curr,
          updatedAt: new Date().toISOString()
        });
        
        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø©
        await batch.commit();
        
        showAlert('ØªÙ… Ø­ÙØ¸ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØµØ±Ù ÙˆØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©', 'success');
        
        // Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„ Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
        currentRecordForInvoice = record;
        
        clearFuelForm();
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…
        loadTodayFuelStats();
        
        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…
        loadFuelDailyTable();
        
        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        previewInvoiceModal();
        
      } catch (error) {
        console.error('Error saving fuel record:', error);
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø¯Ø¯Ø©
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©';
        
        if (error.code === 'permission-denied') {
          errorMessage = 'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯';
        } else if (error.code === 'not-found') {
          errorMessage = 'Ø§Ù„Ù…Ø±ÙƒØ¨Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…';
        } else if (error.code === 'resource-exhausted') {
          errorMessage = 'ØªÙ… ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ù„Ù„Ø¹Ù…Ù„ÙŠØ§ØªØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
        }
        
        showAlert(errorMessage, 'error');
      }
    }
    
    // ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
    function previewInvoiceModal() {
      if (!currentRecordForInvoice) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'error');
        return;
      }
      
      // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
      $('invoiceNumber').textContent = currentRecordForInvoice.opId || 'N/A';
      $('invoiceBranch').textContent = currentRecordForInvoice.branch || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
      $('invoicePlate').textContent = currentRecordForInvoice.plate || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      $('invoiceDriver').textContent = currentRecordForInvoice.driver || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      $('invoiceVehicleType').textContent = currentRecordForInvoice.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†';
      $('invoicePrevOdometer').textContent = fmt(currentRecordForInvoice.prevOdometer || 0, 0) + ' ÙƒÙ…';
      $('invoiceNewOdometer').textContent = fmt(currentRecordForInvoice.newOdometer || 0, 0) + ' ÙƒÙ…';
      $('invoiceDistance').textContent = fmt(currentRecordForInvoice.distance || 0, 1) + ' ÙƒÙ…';
      $('invoiceLiters').textContent = fmt(currentRecordForInvoice.liters || 0, 2) + ' Ù„ØªØ±';
      $('invoiceLiters2').textContent = fmt(currentRecordForInvoice.liters || 0, 2) + ' Ù„ØªØ±';
      $('invoiceGallons').textContent = fmt(currentRecordForInvoice.gallons || 0, 2) + ' Ø¬Ø§Ù„ÙˆÙ†';
      $('invoicePrice').textContent = fmt(currentRecordForInvoice.pricePerLiter || 0, 2) + ' Ø¬Ù†ÙŠÙ‡/Ù„ØªØ±';
      $('invoiceTotal').textContent = fmt(currentRecordForInvoice.totalCost || 0, 2) + ' Ø¬Ù†ÙŠÙ‡';
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
      show($('invoiceModal'));
    }
    
    // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function closeInvoiceModal() {
      hide($('invoiceModal'));
    }
    
    // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function printInvoice() {
      if (!currentRecordForInvoice) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'error');
        return;
      }
      
      printEnhancedInvoice(currentRecordForInvoice, true);
    }
    
    // Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
    function saveInvoice() {
      if (!currentRecordForInvoice) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø­ÙØ¸', 'error');
        return;
      }
      
      showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
      closeInvoiceModal();
    }
    
    function quickFuel(type, liters) {
      if (!checkIfCanDispenseFuel()) {
        showPermissionError('dispenseFuel');
        return;
      }
      showAlert(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${type} ${liters} Ù„ØªØ±`, 'info');
    }
    
    // ÙˆØ¸ÙŠÙØ© Ù…Ø³Ø­ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ÙˆÙ‚ÙˆØ¯
    function clearFuelForm() {
      $('f_plate').value = '';
      $('f_driver').value = '';
      $('f_prev').value = '';
      $('f_curr').value = '';
      $('f_distance').value = '';
      $('f_liters').value = '';
      $('f_gallons').value = '';
      $('f_price').value = '';
      $('f_cost').value = '';
      $('f_notes').value = '';
      
      hide($('sectionLoaded'));
      
      // Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£
      document.querySelectorAll('.form-error').forEach(el => el.classList.remove('show'));
      document.querySelectorAll('.form-input').forEach(el => el.classList.remove('error'));
    }
    
    async function generateOperationNumber() {
      try {
        const counterRef = firestore.collection('counters').doc('operationCounter');
        const transaction = await firestore.runTransaction(async (transaction) => {
          const doc = await transaction.get(counterRef);
          let newCount = 1;
          
          if (doc.exists) {
            newCount = doc.data().value + 1;
          }
          
          transaction.set(counterRef, { value: newCount });
          return newCount;
        });
        
        return transaction;
      } catch (error) {
        console.error('Error generating operation number:', error);
        return Date.now();
      }
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¬Ø¯ÙˆÙ„ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø§Ù„Ø¬Ø¯ÙŠØ¯) ==========
    async function loadFuelDailyTable() {
      const dateFilter = $('dailyFuelDateFilter').value || today();
      const tbody = $('dailyFuelTableBody');
      
      tbody.innerHTML = '<tr><td colspan="8"><div class="loader"><div class="spinner"></div></td></tr>';
      
      try {
        const snapshot = await firestore.collection('fuelRecords')
          .where('date', '==', dateFilter)
          .orderBy('time', 'desc')
          .get();
        
        dailyFuelCache = [];
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 2rem; color: var(--text-gray);">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØ§Ø±ÙŠØ®</td></tr>';
          return;
        }
        
        snapshot.forEach(doc => {
          dailyFuelCache.push(doc.data());
        });
        
        tbody.innerHTML = '';
        dailyFuelCache.forEach((log, index) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${log.time || '--:--'}</td>
            <td><span class="badge badge-primary">${log.plate}</span></td>
            <td>${log.driver}</td>
            <td>${fmt(log.newOdometer, 0)}</td>
            <td>${fmt(log.distance, 1)}</td>
            <td>${fmt(log.liters, 2)}</td>
            <td><div class="cost-cell">${fmt(log.totalCost, 2)}</div></td>
          `;
          tbody.appendChild(tr);
        });
        
      } catch (error) {
        console.error('Error loading daily fuel table:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      }
    }
    
    async function exportDailyFuelToExcel() {
      if (dailyFuelCache.length === 0) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
        return;
      }
      
      let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
      csvContent += "Ø§Ù„ÙˆÙ‚Øª,Ø§Ù„Ù„ÙˆØ­Ø©,Ø§Ù„Ø³Ø§Ø¦Ù‚,Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯,Ø§Ù„Ù…Ø³Ø§ÙØ©,Ø§Ù„Ù„ØªØ±Ø§Øª,Ø§Ù„ØªÙƒÙ„ÙØ©\r\n";
      
      dailyFuelCache.forEach(record => {
        const row = [
          record.time || '',
          record.plate || '',
          record.driver || '',
          record.newOdometer || 0,
          record.distance || 0,
          record.liters || 0,
          record.totalCost || 0
        ].join(',');
        csvContent += row + '\r\n';
      });
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', `Ø¹Ù…Ù„ÙŠØ§Øª_ØµØ±Ù_${$('dailyFuelDateFilter').value}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
          function printDailyFuelTable() {
      if (dailyFuelCache.length === 0) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'warning');
        return;
      }
      
      const dateStr = displayDate($('dailyFuelDateFilter').value);
      const printTime = getCurrentTime();
      const userName = userData.name || currentUser.email; // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
      
      const printWindow = window.open('', '_blank', 'width=800,height=800');
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      let tableHTML = `<table style="width:100%; border-collapse: collapse; font-family: Cairo, sans-serif; margin-top: 20px;">
        <thead>
          <tr style="background: #4f46e5; color: white;">
            <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">#</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„ÙˆÙ‚Øª</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„Ù„ÙˆØ­Ø©</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„Ù…Ø³Ø§ÙØ©</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„Ù„ØªØ±Ø§Øª</th>
            <th style="padding: 12px; border: 1px solid #ddd;">Ø§Ù„ØªÙƒÙ„ÙØ©</th>
          </tr>
        </thead>
        <tbody>`;
      
      dailyFuelCache.forEach((log, index) => {
        tableHTML += `
          <tr>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">${index + 1}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${log.time}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${log.plate}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${log.driver}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${fmt(log.newOdometer,0)}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${fmt(log.distance,1)}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${fmt(log.liters,2)}</td>
            <td style="padding: 10px; border: 1px solid #ddd;">${fmt(log.totalCost,2)}</td>
          </tr>
        `;
      });
      
      tableHTML += `</tbody></table>`;
      
      // ÙƒÙˆØ¯ HTML Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© Ù…Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª
      const html = `
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>Ø·Ø¨Ø§Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ø§Ù„ÙŠÙˆÙ…</title>
          <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
          <style>
            body { 
              font-family: 'Cairo', sans-serif; 
              padding: 20px; 
              background: white; 
              color: #333; 
            }
            .print-header {
              text-align: center;
              padding-bottom: 20px;
              border-bottom: 3px solid #4f46e5;
              margin-bottom: 30px;
            }
            .print-header img {
              max-width: 180px;
              height: auto;
              margin-bottom: 15px;
            }
            .print-header h1 {
              color: #4f46e5;
              margin: 10px 0;
              font-size: 24px;
              font-weight: 800;
            }
            .print-header .company-name {
              font-size: 18px;
              color: #1e293b;
              margin-bottom: 15px;
              font-weight: 600;
            }
            .print-header .info {
              font-size: 14px;
              color: #64748b;
              margin: 5px 0;
              display: inline-block;
              margin-left: 10px;
              font-weight: 600;
            }
            .print-header .info span {
              color: #4f46e5;
              margin-right: 5px;
            }
            
            /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù‚Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
            .signatures-section {
              margin-top: 20px;
              padding: 30px 20px;
              border-top: 2px solid #4f46e5;
              border-bottom: 2px solid #4f46e5;
              background-color: #f8fafc;
            }
            
            .sig-container {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 30px;
              text-align: center;
            }
            
            .sig-box {
              background: white;
              border: 1px solid #e2e8f0;
              padding: 30px 20px;
              border-radius: 12px;
              box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            }
            
            .sig-title {
              font-size: 18px;
              font-weight: 800;
              color: #1e293b;
              margin-bottom: 50px;
            }
            
            .sig-line {
              border-bottom: 2px solid #334155;
              margin-bottom: 15px;
              padding-bottom: 5px;
            }
            
            .sig-name {
              color: #334155;
              font-size: 16px;
              font-weight: 700;
              margin-bottom: 10px;
              letter-spacing: 2px;
            }
          </style>
        </head>
        <body>
          <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
          <div class="print-header">
            <img src="https://adiyatdist.com/wp-content/uploads/2024/12/logo-horizontal.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©">
            <h1>ØªÙ‚Ø±ÙŠØ± Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØµØ±Ù Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h1>
            <div class="company-name">Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª Ù„Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</div>
            <div style="margin-top: 10px;">
              <div class="info"><span>Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> ${dateStr}</div>
              <br>
              <div class="info"><span>ÙˆÙ‚Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©:</span> ${printTime}</div>
              <br>
              <div class="info"><span>Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:</span> ${userName}</div>
            </div>
          </div>
          
          <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
          ${tableHTML}
          
          <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
          <div class="signatures-section">
            <div class="sig-container">
              <!-- ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ -->
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
                <div class="sig-line"></div>
                <div class="sig-name">........................</div>
              </div>
              
              <!-- ØªÙˆÙ‚ÙŠØ¹ Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø±ÙƒØ© -->
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„</div>
                <div class="sig-line"></div>
                <div class="sig-name">........................</div> 
              </div>
              
              <!-- ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± -->
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„</div>
                <div class="sig-line"></div>
                <div class="sig-name">........................</div>
              </div>
            </div>
          </div>
          
          <script>
            window.onload = function() {
              window.print();
              setTimeout(() => {
                window.close();
              }, 1000);
            };
          <\/script>
        </body>
        </html>
      `;
      
      printWindow.document.open();
      printWindow.document.write(html);
      printWindow.document.close();
    }
    
    // ========== ÙˆØ¸Ø§Ø¦Ù ØµÙØ­Ø© Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª ==========
    
    async function loadLogs() {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      const dateFrom = $('filterDateFrom').value;
      const dateTo = $('filterDateTo').value;
      const branch = $('filterBranch').value;
      const vehicleType = $('filterVehicleType').value;
      const driver = $('filterDriver').value.trim();
      const plate = $('filterPlate').value.trim();
      
      try {
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø­Ù‚Ù„ ÙˆØ§Ø­Ø¯ Ù„Ù„ÙØ±Ø² Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø© Ø¥Ù„Ù‰ ÙÙ‡Ø±Ø³ Ù…Ø±ÙƒØ¨
        let query = firestore.collection('fuelRecords').orderBy('date', 'desc');
        
        // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
        if (dateFrom && dateTo) {
          query = query.where('date', '>=', dateFrom).where('date', '<=', dateTo);
        }
        
        if (branch !== 'all') {
          query = query.where('branch', '==', branch);
        }
        
        if (vehicleType !== 'all') {
          query = query.where('vehicleType', '==', vehicleType);
        }
        
        const snapshot = await query.get();
        logsCache = [];
        
        snapshot.forEach(doc => {
          logsCache.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„Ø§ØªØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
        let filteredLogs = logsCache;
        
        if (driver) {
          filteredLogs = filteredLogs.filter(log => 
            log.driver && log.driver.toLowerCase().includes(driver.toLowerCase())
          );
        }
        
        if (plate) {
          filteredLogs = filteredLogs.filter(log => 
            log.plate && log.plate.toLowerCase().includes(plate.toLowerCase())
          );
        }
        
        renderLogsTable(filteredLogs);
        updateLogsStats(filteredLogs);
        
      } catch (error) {
        console.error('Error loading logs:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
      }
    }
    
    function renderLogsTable(logs) {
      const tbody = $('logsTableBody');
      
      if (logs.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="14" style="text-align: center; padding: 2rem; color: var(--text-gray);">
              <div class="empty-state-icon">
                <i class="fas fa-history"></i>
              </div>
              <div class="empty-state-title">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>
              <div class="empty-state-description">Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</div>
            </td>
          </tr>
        `;
        return;
       }
      
      
      tbody.innerHTML = '';
      
      logs.forEach((log, index) => {
        let typeBadgeClass = 'type-petrol';
        let typeIcon = 'fa-gas-pump';
        if (log.vehicleType === 'Ø¬Ø§Ø²') {
          typeBadgeClass = 'type-diesel';
          typeIcon = 'fa-oil-can';
        } else if (log.vehicleType === 'Ù…ÙˆÙ„Ø¯') {
          typeBadgeClass = 'type-generator';
          typeIcon = 'fa-bolt';
        }
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <strong style="font-size: var(--text-sm); color: var(--text-dark);">${displayDate(log.date)}</strong>
              <small style="font-size: var(--text-xs); color: var(--text-gray);">${log.time || '--:--'}</small>
            </div>
          </td>
          <td>${log.time || '--:--'}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <span class="badge badge-warning" style="font-size: var(--text-xs);">${log.plate}</span>
              <span class="vehicle-type ${typeBadgeClass}" style="font-size: 10px; padding: 2px 6px;">
                <i class="fas ${typeIcon}"></i>
              </span>
            </div>
          </td>
          <td>${log.driver || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
          <td>
            <span class="badge badge-info" style="font-size: var(--text-xs);">${log.branch || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
          </td>
          <td>
            <span class="vehicle-type ${typeBadgeClass}" style="font-size: var(--text-xs);">
              <i class="fas ${typeIcon}"></i> ${log.vehicleType || 'Ø¨Ù†Ø²ÙŠÙ†'}
            </span>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ø³Ø§Ø¨Ù‚:</span>
              <strong style="font-size: var(--text-sm); color: var(--primary);">${fmt(log.prevOdometer || 0, 0)}</strong>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ø¬Ø¯ÙŠØ¯:</span>
              <strong style="font-size: var(--text-sm); color: var(--success);">${fmt(log.newOdometer || 0, 0)}</strong>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù…Ø³Ø§ÙØ©:</span>
              <strong style="font-size: var(--text-sm); color: var(--accent);">${fmt(log.distance || 0, 1)} ÙƒÙ…</strong>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-xs); color: var(--text-gray);">Ø§Ù„Ù„ØªØ±Ø§Øª:</span>
              <strong style="font-size: var(--text-sm); color: var(--primary);">${fmt(log.liters || 0, 2)}</strong>
            </div>
          </td>
          <td>
            <div style="background: linear-gradient(135deg, var(--danger), #dc2626); color: white; padding: 4px 8px; border-radius: 6px; text-align: center;">
              <div style="font-size: var(--text-xs); opacity: 0.9;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
              <strong style="font-size: var(--text-sm);">${fmt(log.totalCost || 0, 2)} Ø¬</strong>
            </div>
          </td>
          <td>
            <div style="display: flex; gap: 0.25rem;">
              <button class="btn btn-sm btn-primary" onclick="previewLogInvoice('${log.id}')" title="Ù…Ø¹Ø§ÙŠÙ†Ø©">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn btn-sm btn-success" onclick="printLogInvoice('${log.id}')" title="Ø·Ø¨Ø§Ø¹Ø©">
                <i class="fas fa-print"></i>
              </button>
              <button class="btn btn-sm btn-danger" onclick="deleteLogRecord('${log.id}')" title="Ø­Ø°Ù">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    
    function updateLogsStats(logs) {
      let totalDistance = 0;
      let totalLiters = 0;
      let totalCost = 0;
      let count = logs.length;
      
      logs.forEach(log => {
        totalDistance += parseFloat(log.distance) || 0;
        totalLiters += parseFloat(log.liters) || 0;
        totalCost += parseFloat(log.totalCost) || 0;
      });
      
      const avgKpl = totalDistance > 0 ? (totalDistance / totalLiters).toFixed(2) : 0;
      const avgCost = totalDistance > 0 ? (totalCost / totalDistance).toFixed(2) : 0;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
      $('totalOperations').textContent = count;
      $('totalLiters').textContent = fmt(totalLiters, 2);
      $('totalCost').textContent = fmt(totalCost, 2);
      $('avgConsumption').textContent = avgKpl;
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø©
      $('statCount').textContent = count;
      $('statDistance').textContent = fmt(totalDistance, 1);
      $('statLiters').textContent = fmt(totalLiters, 2);
      $('statCost').textContent = fmt(totalCost, 2);
      $('statAvgKpl').textContent = avgKpl;
      $('statAvgCost').textContent = avgCost;
    }
    
    function clearFilters() {
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙ„Ø§ØªØ±
      const todayDate = today();
      
      $('filterDateFrom').value = todayDate;
      $('filterDateTo').value = todayDate;
      
      $('filterBranch').value = 'all';
      $('filterVehicleType').value = 'all';
      $('filterDriver').value = '';
      $('filterPlate').value = '';
      
      loadLogs();
      showAlert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙÙ„Ø§ØªØ±', 'info');
    }
    
    function refreshLogs() {
      loadLogs();
      showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'success');
    }
    
    async function previewLogInvoice(recordId) {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      try {
        const doc = await firestore.collection('fuelRecords').doc(recordId).get();
        if (doc.exists) {
          currentRecordForInvoice = doc.data();
          previewInvoiceModal();
        } else {
          showAlert('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'error');
        }
      } catch (error) {
        console.error('Error loading record:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„', 'error');
      }
    }
    
    async function printLogInvoice(recordId) {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      try {
        const doc = await firestore.collection('fuelRecords').doc(recordId).get();
        if (doc.exists) {
          printEnhancedInvoice(doc.data(), true); // true ÙŠØ¹Ù†ÙŠ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        } else {
          showAlert('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©', 'error');
        }
      } catch (error) {
        console.error('Error loading record:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„', 'error');
      }
    }
    
    async function deleteLogRecord(recordId) {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')) {
        return;
      }
      
      try {
        await firestore.collection('fuelRecords').doc(recordId).delete();
        showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadLogs();
      } catch (error) {
        console.error('Error deleting log record:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„', 'error');
      }
    }
    
    function changeLogsPage(direction) {
      showAlert('ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
    }

    // ========== ÙˆØ¸ÙŠÙØ© Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…ÙÙ„ØªØ±Ø© ==========
    function printLogsTable() {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
      const tableBody = document.getElementById('logsTableBody');
      if (!tableBody) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'warning');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¨ÙŠØ§Ù†Ø§Øª
      const rows = tableBody.querySelectorAll('tr');
      if (rows.length === 0 || (rows.length === 1 && rows[0].textContent.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª'))) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©', 'warning');
        return;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
      const printWindow = window.open('', '_blank', 'width=1000,height=800');
      
      // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙÙ„ØªØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ
      const dateFrom = document.getElementById('filterDateFrom').value;
      const dateTo = document.getElementById('filterDateTo').value;
      const branch = document.getElementById('filterBranch').value;
      const vehicleType = document.getElementById('filterVehicleType').value;
      const driver = document.getElementById('filterDriver').value.trim();
      const plate = document.getElementById('filterPlate').value.trim();
      
      // ØªØ­Ø¯ÙŠØ¯ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ„Ø§ØªØ±
      let reportTitle = 'Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ§Øª ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯';
      let filterDescription = '';
      
      if (dateFrom && dateTo) {
        filterDescription += `Ø§Ù„ÙØªØ±Ø©: ${displayDate(dateFrom)} Ø¥Ù„Ù‰ ${displayDate(dateTo)}`;
      }
      
      if (branch !== 'all') {
        filterDescription += ` â€¢ Ø§Ù„Ù‚Ø³Ù…: ${branch}`;
      }
      
      if (vehicleType !== 'all') {
        filterDescription += ` â€¢ Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©: ${vehicleType}`;
      }
      
      if (driver) {
        filterDescription += ` â€¢ Ø§Ù„Ø³Ø§Ø¦Ù‚: ${driver}`;
      }
      
      if (plate) {
        filterDescription += ` â€¢ Ø§Ù„Ù„ÙˆØ­Ø©: ${plate}`;
      }
      
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
      let tableRowsHTML = '';
      rows.forEach((row, index) => {
        if (row.textContent.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª')) {
          return;
        }
        
        const cells = row.querySelectorAll('td');
        if (cells.length > 0) {
          // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ù„Ø§ÙŠØ§ (Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª)
          let rowData = '<tr>';
          for (let i = 0; i < cells.length - 1; i++) { // -1 Ù„ØªØ¬Ø§Ù‡Ù„ Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª
            rowData += cells[i].outerHTML;
          }
          rowData += '</tr>';
          tableRowsHTML += rowData;
        }
      });
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      const tableHTML = `
        <table class="print-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„ÙˆÙ‚Øª</th>
              <th>Ø§Ù„Ù„ÙˆØ­Ø©</th>
              <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
              <th>Ø§Ù„Ù‚Ø³Ù…</th>
              <th>Ø§Ù„Ù†ÙˆØ¹</th>
              <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</th>
              <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</th>
              <th>Ø§Ù„Ù…Ø³Ø§ÙØ©</th>
              <th>Ø§Ù„Ù„ØªØ±Ø§Øª</th>
              <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
            </tr>
          </thead>
          <tbody>
            ${tableRowsHTML}
          </tbody>
        </table>
      `;
      
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­ØªÙˆÙ‰ HTML Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
      const html = `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
          <meta charset="UTF-8">
          <title>${reportTitle}</title>
          <style>
            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap');
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { 
              font-family: 'Cairo', sans-serif; 
              padding: 15px; 
              background: white; 
              color: #333; 
              line-height: 1.4;
              font-size: 12px;
            }
            .print-header {
              text-align: center;
              margin-bottom: 20px;
              padding-bottom: 15px;
              border-bottom: 2px solid #4f46e5;
            }
            .print-header img {
              max-width: 150px;
              height: auto;
              margin-bottom: 10px;
            }
            .print-header h1 {
              color: #4f46e5;
              margin-bottom: 5px;
              font-size: 22px;
            }
            .print-header .subtitle {
              color: #666;
              font-size: 14px;
              margin-bottom: 5px;
            }
            .print-filters {
              background: #f8fafc;
              padding: 10px 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              font-size: 12px;
              color: #4f46e5;
              text-align: center;
              font-weight: 600;
            }
            .print-summary {
              display: grid;
              grid-template-columns: repeat(4, 1fr);
              gap: 15px;
              margin-bottom: 20px;
            }
            .summary-card {
              background: #f8fafc;
              border: 1px solid #e2e8f0;
              border-radius: 8px;
              padding: 12px;
              text-align: center;
            }
            .summary-value {
              font-size: 20px;
              font-weight: 700;
              color: #4f46e5;
              margin-bottom: 5px;
            }
            .summary-label {
              font-size: 11px;
              color: #64748b;
            }
            .print-table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 20px;
            }
            .print-table th {
              background: #4f46e5;
              color: white;
              padding: 10px 8px;
              text-align: right;
              font-size: 11px;
              border: 1px solid #4338ca;
            }
            .print-table td {
              padding: 8px;
              border: 1px solid #e2e8f0;
              font-size: 10px;
              vertical-align: middle;
            }
            .print-table tr:nth-child(even) {
              background-color: #f8fafc;
            }
            .print-footer {
              margin-top: 30px;
              padding-top: 15px;
              border-top: 1px dashed #cbd5e1;
              text-align: center;
              font-size: 11px;
              color: #64748b;
            }
            .vehicle-type {
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 9px;
              font-weight: 600;
              display: inline-block;
            }
            .type-petrol {
              background: #3b82f6;
              color: white;
            }
            .type-diesel {
              background: #06b6d4;
              color: white;
            }
            .type-generator {
              background: #f59e0b;
              color: white;
            }
            .badge {
              padding: 2px 6px;
              border-radius: 4px;
              font-size: 9px;
              font-weight: 600;
              display: inline-block;
            }
            .badge-primary {
              background: #3b82f6;
              color: white;
            }
            .badge-info {
              background: #06b6d4;
              color: white;
            }
            .cost-cell {
              background: #ef4444;
              color: white;
              padding: 4px 8px;
              border-radius: 4px;
              text-align: center;
              font-weight: 700;
              font-size: 10px;
            }
            @media print {
              body { padding: 8mm; }
              .no-print { display: none !important; }
              .print-table th {
                font-size: 9px;
                padding: 6px 4px;
              }
              .print-table td {
                font-size: 8px;
                padding: 4px;
              }
            }
          </style>
        </head>
        <body>
          <div class="print-header">
            <img src="https://adiyatdist.com/wp-content/uploads/2024/12/logo-horizontal.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©">
            <h1>${reportTitle}</h1>
            <div class="subtitle">Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª Ù„Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</div>
            <div class="subtitle">${new Date().toLocaleDateString('ar-SA')}</div>
          </div>
          
          ${filterDescription ? `<div class="print-filters">${filterDescription}</div>` : ''}
          
          <div class="print-summary">
            <div class="summary-card">
              <div class="summary-value">${document.getElementById('totalOperations').textContent}</div>
              <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div>
            </div>
            <div class="summary-card">
              <div class="summary-value">${document.getElementById('totalLiters').textContent}</div>
              <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù„ØªØ±Ø§Øª</div>
            </div>
            <div class="summary-card">
              <div class="summary-value">${document.getElementById('totalCost').textContent}</div>
              <div class="summary-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</div>
            </div>
            <div class="summary-card">
              <div class="summary-value">${document.getElementById('avgConsumption').textContent}</div>
              <div class="summary-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
            </div>
          </div>
          
          ${tableHTML}
          
          <div class="print-footer">
            <div>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚ÙˆØ¯</div>
            <div>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${new Date().toLocaleDateString('ar-SA-u-ca-gregory')} ${new Date().toLocaleTimeString('ar-SA')}</div>
            <div>ØªÙ… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ø¨ÙˆØ§Ø³Ø·Ø©: ${userData.name || currentUser.email}</div>
          </div>
          
          <script>
            window.onload = function() {
              setTimeout(() => {
                window.print();
                setTimeout(() => {
                  window.close();
                }, 1000);
              }, 500);
            };
          <\/script>
        </body>
        </html>
      `;
      
      printWindow.document.open();
      printWindow.document.write(html);
      printWindow.document.close();
    }
    
    // ========== ÙˆØ¸Ø§Ø¦Ù ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==========
    async function exportHistoryToExcel() {
      if (!checkIfCanViewReports()) {
        showPermissionError('viewReports');
        return;
      }
      
      const dateFrom = $('filterDateFrom').value;
      const dateTo = $('filterDateTo').value;
      const branch = $('filterBranch').value;
      const vehicleType = $('filterVehicleType').value;
      const driver = $('filterDriver').value.trim();
      const plate = $('filterPlate').value.trim();
      
      try {
        let query = firestore.collection('fuelRecords').orderBy('date', 'desc');
        
        // ØªØ·Ø¨ÙŠÙ‚ ÙÙ„Ø§ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®
        if (dateFrom && dateTo) {
          query = query.where('date', '>=', dateFrom).where('date', '<=', dateTo);
        }
        
        if (branch !== 'all') {
          query = query.where('branch', '==', branch);
        }
        
        if (vehicleType !== 'all') {
          query = query.where('vehicleType', '==', vehicleType);
        }
        
        const snapshot = await query.get();
        const records = [];
        
        snapshot.forEach(doc => {
          records.push(doc.data());
        });
        
        if (records.length === 0) {
          showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
          return;
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ CSV
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
        
        // Ø±Ø£Ø³ Ø§Ù„Ù…Ù„Ù
        const headers = [
          'Ø±Ù‚Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ©',
          'Ø§Ù„ØªØ§Ø±ÙŠØ®',
          'Ø§Ù„ÙˆÙ‚Øª',
          'Ø§Ù„Ù‚Ø³Ù…',
          'Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø©',
          'Ø§Ù„Ø³Ø§Ø¦Ù‚',
          'Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©',
          'Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚',
          'Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯',
          'Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…)',
          'Ø§Ù„Ù„ØªØ±Ø§Øª',
          'Ø§Ù„Ø¬Ø§Ù„ÙˆÙ†Ø§Øª',
          'Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±',
          'Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ',
          'Ù…Ù„Ø§Ø­Ø¸Ø§Øª'
        ].join(',');
        
        csvContent += headers + '\r\n';
        
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        records.forEach(record => {
          const row = [
            record.opId || '',
            record.date || '',
            record.time || '',
            record.branch || '',
            record.plate || '',
            record.driver || '',
            record.vehicleType || '',
            record.prevOdometer || 0,
            record.newOdometer || 0,
            record.distance || 0,
            record.liters || 0,
            record.gallons || 0,
            record.pricePerLiter || 0,
            record.totalCost || 0,
            `"${(record.notes || '').replace(/"/g, '""')}"`
          ].join(',');
          
          csvContent += row + '\r\n';
        });
        
        // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', `Ø³Ø¬Ù„_Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª_${new Date().toISOString().slice(0, 10)}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        
      } catch (error) {
        console.error('Error exporting data:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
      }
    }
    // ========== Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© (ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ÙˆØ±Ù‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„) ==========
    // ========== Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© (ÙˆØ±Ù‚Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¯Ù…Ø¬Ø©) ==========
    function printEnhancedInvoice(record, autoPrint = true) {
      const currentTime = record.time || getCurrentTime();
      const gallons = record.gallons || (record.liters ? (record.liters / 4.546).toFixed(2) : '0.00');
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
      const consumptionRate = record.distance && record.liters 
        ? (record.liters / record.distance * 100).toFixed(2) 
        : '0.00';
      
      const fuelType = record.vehicleType === 'Ø¯ÙŠØ²Ù„' ? 'Ø¯ÙŠØ²Ù„' : 'Ø¨Ù†Ø²ÙŠÙ†';
      const fuelColor = fuelType === 'Ø¯ÙŠØ²Ù„' ? '#059669' : '#dc2626';
      
      // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø·Ø¨Ù‚
      const printedBy = userData.name || currentUser.email;
      
      // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„ØµÙØ­Ø© A4
      const printWindow = window.open('', '_blank', 'width=800,height=1120');
      
      const html = `
        <!DOCTYPE html>
        <html dir="rtl" lang="ar">
        <head>
          <meta charset="UTF-8">
          <title>ÙØ§ØªÙˆØ±Ø© ØµØ±Ù ÙˆÙ‚ÙˆØ¯ - ${record.opId}</title>
          <style>
            @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap');
            
            * { 
              margin: 0; 
              padding: 0; 
              box-sizing: border-box; 
            }
            
            body { 
              font-family: 'Cairo', sans-serif; 
              padding: 15mm 10mm; /* Ù‡ÙˆØ§Ù…Ø´ ØµØºÙŠØ±Ø© Ù„Ù„Ù…Ø­ØªÙˆÙ‰ */
              background: white; 
              color: #1e293b; 
              font-size: 14px; 
              width: 210mm; /* Ø¹Ø±Ø¶ A4 */
              min-height: 297mm; /* Ø§Ø±ØªÙØ§Ø¹ A4 */
              line-height: 1.6;
              margin: 0 auto;
            }
            
            /* Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
            @media print {
              body {
                padding: 10mm 5mm; /* Ù‡ÙˆØ§Ù…Ø´ Ø£Ù‚Ù„ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© */
              }
            }
            
            /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
            .invoice-container {
              width: 100%;
              height: 100%;
              position: relative;
            }
            
            /* Ø§Ù„Ø±Ø£Ø³ */
            .print-header {
              text-align: center;
              padding-bottom: 20px;
              border-bottom: 3px solid #4f46e5;
              margin-bottom: 25px;
            }
            
            .print-header img {
              max-width: 160px;
              height: auto;
              margin-bottom: 10px;
            }
            
            .print-header h1 {
              color: #4f46e5;
              margin: 5px 0;
              font-size: 24px;
              font-weight: 800;
            }
            
            .print-header .company-name {
              font-size: 16px;
              color: #1e293b;
              margin-bottom: 15px;
              font-weight: 700;
            }
            
            .header-info {
              display: flex;
              justify-content: space-around;
              align-items: center;
              background: #f8fafc;
              padding: 10px;
              border-radius: 8px;
              border: 1px solid #e2e8f0;
              font-size: 13px;
              font-weight: 600;
            }
            
            .header-info div {
              display: flex;
              align-items: center;
              gap: 5px;
            }
            
            .header-info i {
              color: #4f46e5;
            }
            
            .header-info span {
              color: #334155;
            }
            
            /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
            .combined-grid {
              display: grid;
              grid-template-columns: repeat(4, 1fr); /* 4 Ø£Ø¹Ù…Ø¯Ø© */
              gap: 15px;
              margin-bottom: 25px;
            }
            
            .detail-box {
              background: #f8fafc;
              border: 1px solid #e2e8f0;
              border-radius: 10px;
              padding: 15px 10px;
              text-align: center;
              transition: all 0.3s;
            }
            
            .detail-box:hover {
              border-color: #4f46e5;
              background: white;
              box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            }
            
            .detail-box .label {
              font-size: 12px;
              color: #64748b;
              font-weight: 600;
              margin-bottom: 8px;
            }
            
            .detail-box .value {
              font-size: 18px;
              font-weight: 800;
              color: #1e293b;
              letter-spacing: -0.5px;
            }
            
            .detail-box .unit {
              font-size: 11px;
              color: #94a3b8;
              display: block;
              margin-top: 4px;
            }
            
            /* ØªØ³Ù„ÙŠØ· Ø®Ø§Øµ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ */
            .detail-box.total-box {
              background: linear-gradient(135deg, #4f46e5, #7c3aed);
              border: none;
            }
            
            .detail-box.total-box .label {
              color: rgba(255, 255, 255, 0.9);
            }
            
            .detail-box.total-box .value {
              color: white;
              font-size: 22px;
            }
            
            .detail-box.total-box .unit {
              color: rgba(255, 255, 255, 0.8);
            }
            
            /* Ù‚Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª */
            .signatures-section {
              display: grid;
              grid-template-columns: repeat(3, 1fr);
              gap: 20px;
              margin-top: 40px;
              padding-top: 30px;
              border-top: 2px dashed #cbd5e1;
            }
            
            .sig-box {
              text-align: center;
              background: #f8fafc;
              border: 1px solid #e2e8f0;
              border-radius: 10px;
              padding: 20px 10px;
            }
            
            .sig-title {
              font-size: 14px;
              font-weight: 800;
              color: #4f46e5;
              margin-bottom: 35px;
            }
            
            .sig-line {
              border-bottom: 2px solid #334155;
              margin-bottom: 15px;
              position: relative;
            }
            
            .sig-name {
              font-weight: 800;
              color: #1e293b;
              font-size: 15px;
              margin-top: 10px;
              letter-spacing: 1px;
            }
            
            .sig-date {
              font-size: 12px;
              color: #64748b;
              margin-top: 5px;
            }
            
            /* Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
            .invoice-footer {
              text-align: center;
              margin-top: 40px;
              padding: 20px;
              background: #f8fafc;
              border-top: 1px solid #e2e8f0;
              color: #64748b;
            }
            
            .footer-text {
              font-size: 14px;
              margin-bottom: 5px;
              font-weight: 700;
            }
            
            .footer-note {
              font-size: 11px;
            }
          </style>
        </head>
        <body>
          <div class="invoice-container">
            <!-- Ø§Ù„Ø±Ø£Ø³ -->
            <div class="print-header">
              <img src="https://adiyatdist.com/wp-content/uploads/2024/12/logo-horizontal.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø´Ø±ÙƒØ©">
              <h1>ÙØ§ØªÙˆØ±Ø© ØµØ±Ù ÙˆÙ‚ÙˆØ¯</h1>
              <div class="company-name">Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª Ù„Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</div>
              
              <div class="header-info">
                <div>
                  <i class="fas fa-calendar-alt"></i>
                  <span>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${displayDate(record.date)}</span>
                </div>
                <div>
                  <i class="fas fa-clock"></i>
                  <span>ÙˆÙ‚Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©: ${getCurrentTime()}</span>
                </div>
                <div>
                  <i class="fas fa-print"></i>
                  <span>Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬: ${printedBy}</span>
                </div>
              </div>
            </div>
            
            <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© (8 ØµÙ†Ø§Ø¯ÙŠÙ‚) -->
            <div class="combined-grid">
              <!-- Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ -->
              <div class="detail-box">
                <div class="label">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚</div>
                <div class="value">${fmt(record.prevOdometer || 0, 0)}</div>
                <div class="unit">ÙƒÙ…</div>
              </div>
              
              <div class="detail-box">
                <div class="label">Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯</div>
                <div class="value">${fmt(record.newOdometer || 0, 0)}</div>
                <div class="unit">ÙƒÙ…</div>
              </div>
              
              <div class="detail-box">
                <div class="label">Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
                <div class="value">${fmt(record.distance || 0, 1)}</div>
                <div class="unit">ÙƒÙ…</div>
              </div>
              
              <div class="detail-box">
                <div class="label">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
                <div class="value">${consumptionRate}</div>
                <div class="unit">Ù„ØªØ±/100ÙƒÙ…</div>
              </div>
              
              <!-- Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ -->
              <div class="detail-box">
                <div class="label">Ø§Ù„Ù„ØªØ±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ù„ÙƒØ©</div>
                <div class="value">${fmt(record.liters || 0, 2)}</div>
                <div class="unit">Ù„ØªØ±</div>
              </div>
              
              <div class="detail-box">
                <div class="label">Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ø¬Ø§Ù„ÙˆÙ†Ø§Øª</div>
                <div class="value">${gallons}</div>
                <div class="unit">Ø¬Ø§Ù„ÙˆÙ†</div>
              </div>
              
              <div class="detail-box">
                <div class="label">Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</div>
                <div class="value">${fmt(record.pricePerLiter || 0, 2)}</div>
                <div class="unit">Ø¬Ù†ÙŠÙ‡</div>
              </div>
              
              <div class="detail-box total-box">
                <div class="label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                <div class="value">${fmt(record.totalCost || 0, 2)}</div>
                <div class="unit">Ø¬Ù†ÙŠÙ‡ Ù…ØµØ±ÙŠ</div>
              </div>
            </div>
            <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙˆÙ‚ÙŠØ¹Ø§Øª -->
            <div class="signatures-section">
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ø³Ø§Ø¦Ù‚</div>
                <div class="sig-line"></div>
                <div class="sig-name">${record.driver}</div>
              </div>
              
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„</div>
                <div class="sig-line"></div>
                <div class="sig-name">....................................</div>
              </div>
              
              <div class="sig-box">
                <div class="sig-title">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ±</div>
                <div class="sig-line"></div>
                <div style="font-size: 12px; color: #64748b; margin-top: 15px;">
                  <i class="fas fa-check-circle" style="color: #059669; font-size: 20px; margin-bottom: 5px;"></i><br>
                  ÙØ§ØªÙˆØ±Ø© Ù…Ø¹ØªÙ…Ø¯Ø©
                </div>
              </div>
            </div>
            
            <!-- Ø§Ù„ØªØ°ÙŠÙŠÙ„ -->
            <div class="invoice-footer">
              <p class="footer-text"> Ø´Ø±ÙƒØ© Ø¹Ø§Ø¯ÙŠØ§Øª Ù„Ù„ØªØ³ÙˆÙŠÙ‚ ÙˆØ§Ù„ØªÙˆØ²ÙŠØ¹</p>
              <p class="footer-note">
                Ù‚Ø³Ù… Ø§Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ù„ØªØ´ØºÙŠÙ„<br>
              </p>
            </div>
          </div>
          
          <script>
            window.onload = function() {
              ${autoPrint ? `
                setTimeout(() => {
                  window.print();
                  setTimeout(() => {
                    window.close();
                  }, 1500);
                }, 500);
              ` : ''}
            };
          <\/script>
        </body>
        </html>
      `;
      
      printWindow.document.open();
      printWindow.document.write(html);
      printWindow.document.close();
    }
    // ========== ÙˆØ¸Ø§Ø¦Ù Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© ==========

    function openUserModal(userId = null) {
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      
      const modal = $('userModal');
      const title = $('userModalTitle');
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
      $('userForm').reset();
      
      // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø³Ù†Ø© Ù…Ù† Ø§Ù„Ø¢Ù†)
      const expiryDate = new Date();
      expiryDate.setFullYear(expiryDate.getFullYear() + 1);
      $('userExpiryDate').value = expiryDate.toISOString().slice(0, 10);
      
      if (userId) {
        // ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
        title.textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
        currentEditingUserId = userId;
        isEditingUser = true;
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        firestore.collection('users').doc(userId).get().then(doc => {
          if (doc.exists) {
            const userData = doc.data();
            $('userName').value = userData.name || '';
            $('userEmail').value = userData.email || '';
            $('userPhone').value = userData.phone || '';
            $('userRole').value = userData.role || 'Ù…Ø³ØªØ®Ø¯Ù…';
            $('userBranch').value = userData.branch || 'Ø§Ù„Ø®Ø±Ø·ÙˆÙ…';
            $('userExpiryDate').value = userData.expiryDate || '';
            $('userStatus').value = userData.status || 'active';
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            const permissions = userData.permissions || {};
            $('permManageVehicles').checked = permissions.manageVehicles || false;
            $('permDispenseFuel').checked = permissions.dispenseFuel || false;
            $('permViewReports').checked = permissions.viewReports || false;
            $('permManageUsers').checked = permissions.manageUsers || false;
          }
        }).catch(error => {
          console.error('Error loading user data:', error);
          showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
        });
      } else {
        // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
        title.textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
        currentEditingUserId = null;
        isEditingUser = false;
        
        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        $('permManageVehicles').checked = true;
        $('permDispenseFuel').checked = true;
        $('permViewReports').checked = true;
        $('permManageUsers').checked = false;
      }
      
      show(modal);
    }

    function closeUserModal() {
      hide($('userModal'));
      currentEditingUserId = null;
      isEditingUser = false;
    }

    async function saveUser(e) {
      if (e) e.preventDefault();
      
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      
      const userName = $('userName').value.trim();
      const userEmail = $('userEmail').value.trim();
      const userPassword = $('userPassword').value;
      const userPhone = $('userPhone').value.trim();
      const userRole = $('userRole').value;
      const userBranch = $('userBranch').value;
      const userExpiryDate = $('userExpiryDate').value;
      const userStatus = $('userStatus').value;
      
      // Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
      const permissions = {
        manageVehicles: $('permManageVehicles').checked,
        dispenseFuel: $('permDispenseFuel').checked,
        viewReports: $('permViewReports').checked,
        manageUsers: $('permManageUsers').checked
      };
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„
      if (!userName || !userEmail) {
        showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(userEmail)) {
        showAlert('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­', 'error');
        return;
      }
      
      // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥Ø¶Ø§ÙØ©ØŒ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
      if (!isEditingUser && !userPassword) {
        showAlert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
        return;
      }
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚ÙˆØ© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
      if (userPassword && userPassword.length < 6) {
        showAlert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
        return;
      }
      
      try {
        if (isEditingUser && currentEditingUserId) {
          // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯
          const updateData = {
            name: userName,
            email: userEmail,
            phone: userPhone,
            role: userRole,
            branch: userBranch,
            expiryDate: userExpiryDate,
            status: userStatus,
            permissions: permissions,
            updatedAt: new Date().toISOString()
          };
          
          // ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙ‚Ø· Ø¥Ø°Ø§ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„Ù‡Ø§
          if (userPassword) {
            updateData.password = userPassword;
          }
          
          await firestore.collection('users').doc(currentEditingUserId).update(updateData);
          showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯
          const newUser = {
            name: userName,
            email: userEmail,
            phone: userPhone,
            role: userRole,
            branch: userBranch,
            expiryDate: userExpiryDate,
            status: userStatus,
            permissions: permissions,
            password: userPassword,
            createdAt: new Date().toISOString()
          };
          
          try {
            // Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ ÙÙŠ Firebase Auth
            const userCredential = await auth.createUserWithEmailAndPassword(userEmail, userPassword);
            const userId = userCredential.user.uid;
            
            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Firestore
            await firestore.collection('users').doc(userId).set(newUser);
            
            showAlert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
          } catch (authError) {
            // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            let errorMessage = '';
            
            switch (authError.code) {
              case 'auth/email-already-in-use':
                errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø¢Ø®Ø±';
                break;
              case 'auth/invalid-email':
                errorMessage = 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
                break;
              case 'auth/weak-password':
                errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø£Ù‚ÙˆÙ‰ (6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„)';
                break;
              case 'auth/operation-not-allowed':
                errorMessage = 'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±';
                break;
              default:
                errorMessage = `Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ${authError.message}`;
            }
            
            showAlert(errorMessage, 'error');
            return; // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
          }
        }
        
        closeUserModal();
        loadUsersList();
        
      } catch (error) {
        console.error('Error saving user:', error);
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø®Ø·Ø§Ø¡ Firestore
        let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
        
        if (error.code === 'permission-denied') {
          errorMessage = 'Ù„Ø§ ØªÙ…Ù„Ùƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯';
        } else if (error.code === 'not-found') {
          errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯';
        } else if (error.code === 'already-exists') {
          errorMessage = 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„';
        }
        
        showAlert(errorMessage, 'error');
      }
    }

    async function loadUsersList() {
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      
      const tbody = $('usersTableBody');
      tbody.innerHTML = '<tr id="loadingUsersRow"><td colspan="10"><div class="loader"><div class="spinner"></div><div style="margin-top: 0.5rem; color: var(--text-gray); font-size: var(--text-sm);">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†...</div></td></tr>';
      
      try {
        const snapshot = await firestore.collection('users').get();
        allUsersCache = [];
        
        snapshot.forEach(doc => {
          allUsersCache.push({
            id: doc.id,
            ...doc.data()
          });
        });
        
        updateUsersStats(allUsersCache);
        renderUsersTable(allUsersCache);
        
      } catch (error) {
        console.error('Error loading users:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
      }
    }
    
    function updateUsersStats(users) {
      const totalUsers = users.length;
      const activeUsers = users.filter(user => user.status === 'active').length;
      const managersCount = users.filter(user => user.role === 'Ù…Ø¯ÙŠØ±').length;
      const supervisorsCount = users.filter(user => user.role === 'Ù…Ø´Ø±Ù').length;
      
      $('totalUsers').textContent = totalUsers;
      $('activeUsers').textContent = activeUsers;
      $('managersCount').textContent = managersCount;
      $('supervisorsCount').textContent = supervisorsCount;
    }
    
    function renderUsersTable(users) {
      const tbody = $('usersTableBody');
      
      if (users.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" style="text-align: center; padding: 2rem; color: var(--text-gray);">
              <div class="empty-state-icon">
                <i class="fas fa-users"></i>
              </div>
              <div class="empty-state-title">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ†</div>
              <div class="empty-state-description">Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = '';
      
      users.forEach((user, index) => {
        let roleDisplay = user.role;
        let roleIcon = 'fa-user-tie';
        let roleColor = 'info';
        
        if (user.role === 'Ù…Ø¯ÙŠØ±') {
          roleDisplay = 'Ù…Ø¯ÙŠØ±';
          roleIcon = 'fa-user-cog';
          roleColor = 'danger';
        } else if (user.role === 'Ù…Ø´Ø±Ù') {
          roleDisplay = 'Ù…Ø´Ø±Ù';
          roleIcon = 'fa-user-shield';
          roleColor = 'warning';
        }
        
        let statusClass = 'badge-success';
        let statusIcon = 'fa-check-circle';
        let statusText = 'Ù†Ø´Ø·';
        
        if (user.status === 'suspended') {
          statusClass = 'badge-danger';
          statusIcon = 'fa-pause-circle';
          statusText = 'Ù…ÙˆÙ‚ÙˆÙ';
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨
        let expiryClass = '';
        let expiryText = displayDate(user.expiryDate) || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
        
        if (user.expiryDate) {
          const expiryDate = new Date(user.expiryDate);
          const today = new Date();
          
          if (expiryDate < today) {
            expiryClass = 'style="color: var(--danger); font-weight: 700;"';
            expiryText += ' (Ù…Ù†ØªÙ‡ÙŠ)';
          } else if (expiryDate < new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000)) {
            expiryClass = 'style="color: var(--warning); font-weight: 600;"';
            expiryText += ' (Ù‚Ø±ÙŠØ¨)';
          }
        }
        
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${index + 1}</td>
          <td>
            <div style="display: flex; align-items: center; gap: 0.75rem;">
              <div class="user-avatar-small" style="width: 36px; height: 36px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 14px;">
                ${user.name ? user.name.charAt(0).toUpperCase() : 'U'}
              </div>
              <div>
                <div style="font-weight: 700; color: var(--text-dark); font-size: var(--text-sm);">${user.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</div>
                <div style="font-size: var(--text-xs); color: var(--text-gray);">ID: ${user.id.substring(0, 8)}</div>
              </div>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-sm); color: var(--text-dark);">${user.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas ${roleIcon}" style="color: var(--${roleColor}); font-size: 14px;"></i>
              <span class="badge badge-${roleColor}" style="font-size: var(--text-xs);">${roleDisplay}</span>
            </div>
          </td>
          <td>
            <span class="badge badge-primary" style="font-size: var(--text-xs);">${user.branch || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas fa-phone" style="color: var(--info); font-size: 12px;"></i>
              <span style="font-size: var(--text-sm); color: var(--text-dark);">${user.phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
            </div>
          </td>
          <td>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
              <i class="fas ${statusIcon}" style="color: var(--${statusClass === 'badge-success' ? 'success' : 'danger'}); font-size: 12px;"></i>
              <span class="badge ${statusClass}" style="font-size: var(--text-xs);">${statusText}</span>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-sm); color: var(--text-dark);">${displayDate(user.createdAt)}</span>
            </div>
          </td>
          <td>
            <div style="display: flex; flex-direction: column; gap: 2px;">
              <span style="font-size: var(--text-sm); color: var(--text-dark);" ${expiryClass}>${expiryText}</span>
            </div>
          </td>
          <td class="no-print">
            <div style="display: flex; gap: 0.25rem;">
              <button class="btn btn-sm btn-primary" 
                      onclick="openUserModal('${user.id}')"
                      style="padding: 4px 6px; font-size: 10px;"
                      title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-danger" 
                      onclick="deleteUser('${user.id}', '${user.name}')"
                      style="padding: 4px 6px; font-size: 10px;"
                      title="Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    
    function searchUsers(query) {
      if (!query) {
        renderUsersTable(allUsersCache);
        return;
      }
      
      const filtered = allUsersCache.filter(user => 
        (user.name && user.name.toLowerCase().includes(query.toLowerCase())) ||
        (user.email && user.email.toLowerCase().includes(query.toLowerCase())) ||
        (user.role && user.role.toLowerCase().includes(query.toLowerCase())) ||
        (user.branch && user.branch.toLowerCase().includes(query.toLowerCase())) ||
        (user.phone && user.phone.includes(query))
      );
      
      renderUsersTable(filtered);
    }
    
    function filterUsers(filter) {
      let filtered = allUsersCache;
      
      if (filter !== 'all') {
        if (['Ù…Ø¯ÙŠØ±', 'Ù…Ø´Ø±Ù', 'Ù…Ø³ØªØ®Ø¯Ù…'].includes(filter)) {
          filtered = allUsersCache.filter(user => user.role === filter);
        } else if (filter === 'active') {
          filtered = allUsersCache.filter(user => user.status === 'active');
        } else if (filter === 'suspended') {
          filtered = allUsersCache.filter(user => user.status === 'suspended');
        }
      }
      
      renderUsersTable(filtered);
    }
    
    async function deleteUser(userId, userName) {
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      
      if (!confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… "${userName}"ØŸ`)) {
        return;
      }
      
      try {
        // Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firebase Auth
        await auth.deleteUser(userId);
        
        // Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
        await firestore.collection('users').doc(userId).delete();
        
        showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        loadUsersList();
      } catch (error) {
        console.error('Error deleting user:', error);
        showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
      }
    }
    
    function exportUsersToExcel() {
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      
      if (allUsersCache.length === 0) {
        showAlert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
        return;
      }
      
      // Ø¥Ù†Ø´Ø§Ø¡ CSV
      let csvContent = "data:text/csv;charset=utf-8,\uFEFF";
      
      // Ø±Ø£Ø³ Ø§Ù„Ù…Ù„Ù
      const headers = [
        'Ø§Ù„Ø±Ù‚Ù…',
        'Ø§Ù„Ø§Ø³Ù…',
        'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
        'Ø§Ù„Ø¯ÙˆØ±',
        'Ø§Ù„Ù‚Ø³Ù…',
        'Ø§Ù„Ù‡Ø§ØªÙ',
        'Ø§Ù„Ø­Ø§Ù„Ø©',
        'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„',
        'ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡',
        'ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª',
        'ØµÙ„Ø§Ø­ÙŠØ© ØµØ±Ù Ø§Ù„ÙˆÙ‚ÙˆØ¯',
        'ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±',
        'ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†'
      ].join(',');
      
      csvContent += headers + '\r\n';
      
      // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      allUsersCache.forEach((user, index) => {
        const permissions = user.permissions || {};
        const row = [
          index + 1,
          user.name || '',
          user.email || '',
          user.role || '',
          user.branch || '',
          user.phone || '',
          user.status === 'active' ? 'Ù†Ø´Ø·' : 'Ù…ÙˆÙ‚ÙˆÙ',
          displayDate(user.createdAt),
          displayDate(user.expiryDate),
          permissions.manageVehicles ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
          permissions.dispenseFuel ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
          permissions.viewReports ? 'Ù†Ø¹Ù…' : 'Ù„Ø§',
          permissions.manageUsers ? 'Ù†Ø¹Ù…' : 'Ù„Ø§'
        ].join(',');
        
        csvContent += row + '\r\n';
      });
      
      // ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement('a');
      link.setAttribute('href', encodedUri);
      link.setAttribute('download', `Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†_Ù†Ø¸Ø§Ù…_Ø§Ù„ÙˆÙ‚ÙˆØ¯_${new Date().toISOString().slice(0, 10)}.csv`);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­', 'success');
    }
    
    function printUsers() {
      if (!checkIfCanManageUsers()) {
        showPermissionError('manageUsers');
        return;
      }
      showAlert('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©...', 'info');
    }
    
    function changeUsersPage(direction) {
      showAlert('ØªØºÙŠÙŠØ± Ø§Ù„ØµÙØ­Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info');
    }

    // ========== ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© ==========

    // ÙˆØ¸ÙŠÙØ© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø¹ÙŠÙ†
    async function getSetting(settingName) {
      try {
        const doc = await firestore.collection('settings').doc('appSettings').get();
        if (doc.exists) {
          const settings = doc.data();
          return settings[settingName];
        }
        return null;
      } catch (error) {
        console.error('Error getting setting:', error);
        return null;
      }
    }
    
  </script>
</body>
</html>
